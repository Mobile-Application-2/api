var ov=Object.defineProperty;var uv=(u,n,i)=>n in u?ov(u,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):u[n]=i;var A=(u,n,i)=>uv(u,typeof n!="symbol"?n+"":n,i);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))o(f);new MutationObserver(f=>{for(const _ of f)if(_.type==="childList")for(const b of _.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&o(b)}).observe(document,{childList:!0,subtree:!0});function i(f){const _={};return f.integrity&&(_.integrity=f.integrity),f.referrerPolicy&&(_.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?_.credentials="include":f.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function o(f){if(f.ep)return;f.ep=!0;const _=i(f);fetch(f.href,_)}})();class D{constructor(n,i){A(this,"_x");A(this,"_y");this._x=n,this._y=i}get x(){return this._x}get y(){return this._y}static get zero(){return new D(0,0)}get length(){return Math.sqrt(Math.pow(this._x,2)+Math.pow(this._y,2))}static copy(n){return new D(n.x,n.y)}addX(n){return new D(this._x,this._y).addToX(n)}addY(n){return new D(this._x,this._y).addToY(n)}addToX(n){return this._x+=n,this}addToY(n){return this._y+=n,this}addTo(n){return this.addToX(n.x).addToY(n.y)}add(n){return new D(this._x,this._y).addTo(n)}subtractTo(n){return this._x-=n.x,this._y-=n.y,this}subtract(n){return new D(this._x,this._y).subtractTo(n)}mult(n){return new D(this._x,this._y).multBy(n)}multBy(n){return this._x*=n,this._y*=n,this}dot(n){return this._x*n.x+this._y*n.y}distFrom(n){return this.subtract(n).length}}var yt=(u=>(u[u.CONTINUE=0]="CONTINUE",u[u.PVP=1]="PVP",u[u.PVC=2]="PVC",u[u.ToggleSound=3]="ToggleSound",u[u.GoToSubMenu=4]="GoToSubMenu",u[u.GoToPreviousMenu=5]="GoToPreviousMenu",u))(yt||{});const E={gameSize:{x:1500,y:825},soundOn:!0,timeoutToHideStickAfterShot:500,loadingScreenTimeout:5e3,loadingScreenImagePosition:{x:450,y:112.5},timeoutToLoadSubMenu:100,labels:{currentPlayer:{position:{x:640,y:260},color:"#126736",font:"70px Impact",alignment:"top",text:"PLAYER "},overalScores:[{position:{x:628,y:460},color:"#126736",font:"200px Impact",alignment:"top"},{position:{x:778,y:460},color:"#126736",font:"200px Impact",alignment:"top"}]},cueBallPosition:{x:413,y:413},matchScore:{scoresPositions:[{x:420,y:27},{x:932,y:27}],unitMargin:20},sprites:{basePath:"/game/Snooker/assets/sprites/",paths:{menuBackground:"main_menu_background.png",table:"spr_background4.png",cueBall:"spr_ball2.png",redBall:"spr_redBall2.png",yellowBall:"spr_yellowBall2.png",blackBall:"spr_blackBall2.png",stick:"spr_stick.png",twoPlayersButton:"2_players_button.png",twoPlayersButtonHovered:"2_players_button_hover.png",onePlayerButton:"1_player_button.png",onePlayerButtonHovered:"1_player_button_hover.png",muteButton:"mute_button.png",muteButtonHovered:"mute_button_hover.png",muteButtonPressed:"mute_button_pressed.png",muteButtonPressedHovered:"mute_button_pressed_hover.png",easyButton:"easy_button.png",easyButtonHovered:"easy_button_hover.png",mediumButton:"medium_button.png",mediumButtonHovered:"medium_button_hover.png",hardButton:"hard_button.png",hardButtonHovered:"hard_button_hover.png",backButton:"back_button.png",backButtonHovered:"back_button_hover.png",continueButton:"continue_button.png",continueButtonHovered:"continue_button_hover.png",insaneButton:"insane_button.png",insaneButtonHovered:"insane_button_hover.png",controls:"controls.png",redScore:"red_score.png",yellowScore:"yellow_score.png"}},sounds:{basePath:"/game/Snooker/assets/sounds/",paths:{ballsCollide:"BallsCollide.wav",strike:"Strike.wav",rail:"Hole.wav"}},physics:{friction:.018,collisionLoss:.018},table:{cushionWidth:57,pocketRadius:48,pocketsPositions:[{x:62,y:62},{x:750,y:32},{x:1435,y:62},{x:62,y:762},{x:750,y:794},{x:1435,y:762}]},ball:{diameter:38,origin:{x:25,y:25},minVelocityLength:.05,maxExpectedCollisionForce:70},stick:{origin:{x:970,y:11},shotOrigin:{x:950,y:11},powerToAddPerFrame:1,movementPerFrame:3,maxPower:50},input:{mouseSelectButton:0,mouseShootButton:0,mousePlaceBallButton:0,increaseShotPowerKey:87,decreaseShotPowerKey:83,toggleMenuKey:27},mainMenu:{labels:[{text:"Classic 8-Ball",position:{x:200,y:100},font:"100px Bookman",color:"white",alignment:"left"},{text:`© ${new Date().getFullYear()} Chen Shmilovich`,position:{x:1250,y:800},font:"20px Bookman",color:"white",alignment:"left"}],buttons:[{action:yt.PVP,position:{x:200,y:200},sprite:"twoPlayersButton",spriteOnHover:"twoPlayersButtonHovered"},{action:yt.GoToSubMenu,value:0,position:{x:200,y:400},sprite:"onePlayerButton",spriteOnHover:"onePlayerButtonHovered"},{action:yt.ToggleSound,position:{x:1430,y:10},sprite:"muteButton",spriteOnHover:"muteButtonHovered"}],subMenus:[{labels:[{text:"Choose Difficulty",position:{x:200,y:80},font:"70px Bookman",color:"white",alignment:"left"},{text:`© ${new Date().getFullYear()} Chen Shmilovich`,position:{x:1250,y:800},font:"20px Bookman",color:"white",alignment:"left"}],buttons:[{action:yt.GoToPreviousMenu,position:{x:100,y:150},sprite:"backButton",spriteOnHover:"backButtonHovered"},{action:yt.PVC,position:{x:200,y:150},value:30,sprite:"easyButton",spriteOnHover:"easyButtonHovered"},{action:yt.PVC,position:{x:200,y:300},value:50,sprite:"mediumButton",spriteOnHover:"mediumButtonHovered"},{action:yt.PVC,position:{x:200,y:450},value:100,sprite:"hardButton",spriteOnHover:"hardButtonHovered"},{action:yt.PVC,position:{x:200,y:600},value:700,sprite:"insaneButton",spriteOnHover:"insaneButtonHovered"},{action:yt.ToggleSound,position:{x:1430,y:10},sprite:"muteButton",spriteOnHover:"muteButtonHovered"}],subMenus:[]}]},cursor:{default:"default",button:"pointer"},ai:{on:!0,trainIterations:30,playerIndex:1,ballDistanceBonus:1/5800,validTurnBonus:5e3,pocketedBallBonus:2e3,invalidTurnPenalty:3e3,gameWonBonus:5e4,gameLossPenalty:5e4,shotPowerMutationVariance:15,minShotPower:10}};class ws{constructor(n=50,i=0,o=0){this.power=n,this.rotation=i,this.evaluation=o}}class av{constructor(){}evaluate(n){let i=1;for(let o=0;o<n.balls.length;o++)for(let f=o+1;f<n.balls.length;f++){let _=n.balls[o],b=n.balls[f];i+=_.position.distFrom(b.position)*E.ai.ballDistanceBonus}return n.isTurnValid?(i+=E.ai.validTurnBonus,i+=E.ai.pocketedBallBonus*n.numOfPocketedBallsOnTurn,n.isGameOver&&(i+=E.ai.gameWonBonus)):(i=i-E.ai.invalidTurnPenalty,n.isGameOver&&(i-=E.ai.gameLossPenalty)),i}}var Wr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lv(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var Un={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */var cv=Un.exports,Ba;function hv(){return Ba||(Ba=1,function(u,n){(function(){var i,o="4.17.21",f=200,_="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",b="Expected a function",P="Invalid `variable` option passed into `_.template`",L="__lodash_hash_undefined__",ct=500,tt="__lodash_placeholder__",F=1,Zt=2,we=4,xe=1,$e=2,qt=1,Ke=2,$s=4,se=8,pn=16,oe=32,dn=64,ue=128,gn=256,Qr=512,cl=30,hl="...",fl=800,pl=16,Ks=1,dl=2,gl=3,$n=1/0,Ye=9007199254740991,_l=17976931348623157e292,Kn=NaN,Qt=4294967295,vl=Qt-1,ml=Qt>>>1,yl=[["ary",ue],["bind",qt],["bindKey",Ke],["curry",se],["curryRight",pn],["flip",Qr],["partial",oe],["partialRight",dn],["rearg",gn]],Xe="[object Arguments]",Yn="[object Array]",wl="[object AsyncFunction]",_n="[object Boolean]",vn="[object Date]",xl="[object DOMException]",Xn="[object Error]",zn="[object Function]",Ys="[object GeneratorFunction]",$t="[object Map]",mn="[object Number]",bl="[object Null]",ae="[object Object]",Xs="[object Promise]",Sl="[object Proxy]",yn="[object RegExp]",Kt="[object Set]",wn="[object String]",Vn="[object Symbol]",Bl="[object Undefined]",xn="[object WeakMap]",Tl="[object WeakSet]",bn="[object ArrayBuffer]",ze="[object DataView]",jr="[object Float32Array]",ti="[object Float64Array]",ei="[object Int8Array]",ni="[object Int16Array]",ri="[object Int32Array]",ii="[object Uint8Array]",si="[object Uint8ClampedArray]",oi="[object Uint16Array]",ui="[object Uint32Array]",Al=/\b__p \+= '';/g,Cl=/\b(__p \+=) '' \+/g,El=/(__e\(.*?\)|\b__t\)) \+\n'';/g,zs=/&(?:amp|lt|gt|quot|#39);/g,Vs=/[&<>"']/g,Pl=RegExp(zs.source),Ol=RegExp(Vs.source),Rl=/<%-([\s\S]+?)%>/g,Il=/<%([\s\S]+?)%>/g,Js=/<%=([\s\S]+?)%>/g,Ll=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,kl=/^\w*$/,Ml=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ai=/[\\^$.*+?()[\]{}|]/g,Nl=RegExp(ai.source),li=/^\s+/,Dl=/\s/,Wl=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Fl=/\{\n\/\* \[wrapped with (.+)\] \*/,Ul=/,? & /,Hl=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Gl=/[()=,{}\[\]\/\s]/,ql=/\\(\\)?/g,$l=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Zs=/\w*$/,Kl=/^[-+]0x[0-9a-f]+$/i,Yl=/^0b[01]+$/i,Xl=/^\[object .+?Constructor\]$/,zl=/^0o[0-7]+$/i,Vl=/^(?:0|[1-9]\d*)$/,Jl=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Jn=/($^)/,Zl=/['\n\r\u2028\u2029\\]/g,Zn="\\ud800-\\udfff",Ql="\\u0300-\\u036f",jl="\\ufe20-\\ufe2f",tc="\\u20d0-\\u20ff",Qs=Ql+jl+tc,js="\\u2700-\\u27bf",to="a-z\\xdf-\\xf6\\xf8-\\xff",ec="\\xac\\xb1\\xd7\\xf7",nc="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",rc="\\u2000-\\u206f",ic=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",eo="A-Z\\xc0-\\xd6\\xd8-\\xde",no="\\ufe0e\\ufe0f",ro=ec+nc+rc+ic,ci="['’]",sc="["+Zn+"]",io="["+ro+"]",Qn="["+Qs+"]",so="\\d+",oc="["+js+"]",oo="["+to+"]",uo="[^"+Zn+ro+so+js+to+eo+"]",hi="\\ud83c[\\udffb-\\udfff]",uc="(?:"+Qn+"|"+hi+")",ao="[^"+Zn+"]",fi="(?:\\ud83c[\\udde6-\\uddff]){2}",pi="[\\ud800-\\udbff][\\udc00-\\udfff]",Ve="["+eo+"]",lo="\\u200d",co="(?:"+oo+"|"+uo+")",ac="(?:"+Ve+"|"+uo+")",ho="(?:"+ci+"(?:d|ll|m|re|s|t|ve))?",fo="(?:"+ci+"(?:D|LL|M|RE|S|T|VE))?",po=uc+"?",go="["+no+"]?",lc="(?:"+lo+"(?:"+[ao,fi,pi].join("|")+")"+go+po+")*",cc="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",hc="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",_o=go+po+lc,fc="(?:"+[oc,fi,pi].join("|")+")"+_o,pc="(?:"+[ao+Qn+"?",Qn,fi,pi,sc].join("|")+")",dc=RegExp(ci,"g"),gc=RegExp(Qn,"g"),di=RegExp(hi+"(?="+hi+")|"+pc+_o,"g"),_c=RegExp([Ve+"?"+oo+"+"+ho+"(?="+[io,Ve,"$"].join("|")+")",ac+"+"+fo+"(?="+[io,Ve+co,"$"].join("|")+")",Ve+"?"+co+"+"+ho,Ve+"+"+fo,hc,cc,so,fc].join("|"),"g"),vc=RegExp("["+lo+Zn+Qs+no+"]"),mc=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,yc=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],wc=-1,Q={};Q[jr]=Q[ti]=Q[ei]=Q[ni]=Q[ri]=Q[ii]=Q[si]=Q[oi]=Q[ui]=!0,Q[Xe]=Q[Yn]=Q[bn]=Q[_n]=Q[ze]=Q[vn]=Q[Xn]=Q[zn]=Q[$t]=Q[mn]=Q[ae]=Q[yn]=Q[Kt]=Q[wn]=Q[xn]=!1;var Z={};Z[Xe]=Z[Yn]=Z[bn]=Z[ze]=Z[_n]=Z[vn]=Z[jr]=Z[ti]=Z[ei]=Z[ni]=Z[ri]=Z[$t]=Z[mn]=Z[ae]=Z[yn]=Z[Kt]=Z[wn]=Z[Vn]=Z[ii]=Z[si]=Z[oi]=Z[ui]=!0,Z[Xn]=Z[zn]=Z[xn]=!1;var xc={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},bc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Sc={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Bc={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Tc=parseFloat,Ac=parseInt,vo=typeof Wr=="object"&&Wr&&Wr.Object===Object&&Wr,Cc=typeof self=="object"&&self&&self.Object===Object&&self,ht=vo||Cc||Function("return this")(),gi=n&&!n.nodeType&&n,Me=gi&&!0&&u&&!u.nodeType&&u,mo=Me&&Me.exports===gi,_i=mo&&vo.process,It=function(){try{var d=Me&&Me.require&&Me.require("util").types;return d||_i&&_i.binding&&_i.binding("util")}catch{}}(),yo=It&&It.isArrayBuffer,wo=It&&It.isDate,xo=It&&It.isMap,bo=It&&It.isRegExp,So=It&&It.isSet,Bo=It&&It.isTypedArray;function At(d,m,v){switch(v.length){case 0:return d.call(m);case 1:return d.call(m,v[0]);case 2:return d.call(m,v[0],v[1]);case 3:return d.call(m,v[0],v[1],v[2])}return d.apply(m,v)}function Ec(d,m,v,T){for(var k=-1,K=d==null?0:d.length;++k<K;){var ot=d[k];m(T,ot,v(ot),d)}return T}function Lt(d,m){for(var v=-1,T=d==null?0:d.length;++v<T&&m(d[v],v,d)!==!1;);return d}function Pc(d,m){for(var v=d==null?0:d.length;v--&&m(d[v],v,d)!==!1;);return d}function To(d,m){for(var v=-1,T=d==null?0:d.length;++v<T;)if(!m(d[v],v,d))return!1;return!0}function be(d,m){for(var v=-1,T=d==null?0:d.length,k=0,K=[];++v<T;){var ot=d[v];m(ot,v,d)&&(K[k++]=ot)}return K}function jn(d,m){var v=d==null?0:d.length;return!!v&&Je(d,m,0)>-1}function vi(d,m,v){for(var T=-1,k=d==null?0:d.length;++T<k;)if(v(m,d[T]))return!0;return!1}function j(d,m){for(var v=-1,T=d==null?0:d.length,k=Array(T);++v<T;)k[v]=m(d[v],v,d);return k}function Se(d,m){for(var v=-1,T=m.length,k=d.length;++v<T;)d[k+v]=m[v];return d}function mi(d,m,v,T){var k=-1,K=d==null?0:d.length;for(T&&K&&(v=d[++k]);++k<K;)v=m(v,d[k],k,d);return v}function Oc(d,m,v,T){var k=d==null?0:d.length;for(T&&k&&(v=d[--k]);k--;)v=m(v,d[k],k,d);return v}function yi(d,m){for(var v=-1,T=d==null?0:d.length;++v<T;)if(m(d[v],v,d))return!0;return!1}var Rc=wi("length");function Ic(d){return d.split("")}function Lc(d){return d.match(Hl)||[]}function Ao(d,m,v){var T;return v(d,function(k,K,ot){if(m(k,K,ot))return T=K,!1}),T}function tr(d,m,v,T){for(var k=d.length,K=v+(T?1:-1);T?K--:++K<k;)if(m(d[K],K,d))return K;return-1}function Je(d,m,v){return m===m?Kc(d,m,v):tr(d,Co,v)}function kc(d,m,v,T){for(var k=v-1,K=d.length;++k<K;)if(T(d[k],m))return k;return-1}function Co(d){return d!==d}function Eo(d,m){var v=d==null?0:d.length;return v?bi(d,m)/v:Kn}function wi(d){return function(m){return m==null?i:m[d]}}function xi(d){return function(m){return d==null?i:d[m]}}function Po(d,m,v,T,k){return k(d,function(K,ot,J){v=T?(T=!1,K):m(v,K,ot,J)}),v}function Mc(d,m){var v=d.length;for(d.sort(m);v--;)d[v]=d[v].value;return d}function bi(d,m){for(var v,T=-1,k=d.length;++T<k;){var K=m(d[T]);K!==i&&(v=v===i?K:v+K)}return v}function Si(d,m){for(var v=-1,T=Array(d);++v<d;)T[v]=m(v);return T}function Nc(d,m){return j(m,function(v){return[v,d[v]]})}function Oo(d){return d&&d.slice(0,ko(d)+1).replace(li,"")}function Ct(d){return function(m){return d(m)}}function Bi(d,m){return j(m,function(v){return d[v]})}function Sn(d,m){return d.has(m)}function Ro(d,m){for(var v=-1,T=d.length;++v<T&&Je(m,d[v],0)>-1;);return v}function Io(d,m){for(var v=d.length;v--&&Je(m,d[v],0)>-1;);return v}function Dc(d,m){for(var v=d.length,T=0;v--;)d[v]===m&&++T;return T}var Wc=xi(xc),Fc=xi(bc);function Uc(d){return"\\"+Bc[d]}function Hc(d,m){return d==null?i:d[m]}function Ze(d){return vc.test(d)}function Gc(d){return mc.test(d)}function qc(d){for(var m,v=[];!(m=d.next()).done;)v.push(m.value);return v}function Ti(d){var m=-1,v=Array(d.size);return d.forEach(function(T,k){v[++m]=[k,T]}),v}function Lo(d,m){return function(v){return d(m(v))}}function Be(d,m){for(var v=-1,T=d.length,k=0,K=[];++v<T;){var ot=d[v];(ot===m||ot===tt)&&(d[v]=tt,K[k++]=v)}return K}function er(d){var m=-1,v=Array(d.size);return d.forEach(function(T){v[++m]=T}),v}function $c(d){var m=-1,v=Array(d.size);return d.forEach(function(T){v[++m]=[T,T]}),v}function Kc(d,m,v){for(var T=v-1,k=d.length;++T<k;)if(d[T]===m)return T;return-1}function Yc(d,m,v){for(var T=v+1;T--;)if(d[T]===m)return T;return T}function Qe(d){return Ze(d)?zc(d):Rc(d)}function Yt(d){return Ze(d)?Vc(d):Ic(d)}function ko(d){for(var m=d.length;m--&&Dl.test(d.charAt(m)););return m}var Xc=xi(Sc);function zc(d){for(var m=di.lastIndex=0;di.test(d);)++m;return m}function Vc(d){return d.match(di)||[]}function Jc(d){return d.match(_c)||[]}var Zc=function d(m){m=m==null?ht:je.defaults(ht.Object(),m,je.pick(ht,yc));var v=m.Array,T=m.Date,k=m.Error,K=m.Function,ot=m.Math,J=m.Object,Ai=m.RegExp,Qc=m.String,kt=m.TypeError,nr=v.prototype,jc=K.prototype,tn=J.prototype,rr=m["__core-js_shared__"],ir=jc.toString,X=tn.hasOwnProperty,th=0,Mo=function(){var t=/[^.]+$/.exec(rr&&rr.keys&&rr.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),sr=tn.toString,eh=ir.call(J),nh=ht._,rh=Ai("^"+ir.call(X).replace(ai,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),or=mo?m.Buffer:i,Te=m.Symbol,ur=m.Uint8Array,No=or?or.allocUnsafe:i,ar=Lo(J.getPrototypeOf,J),Do=J.create,Wo=tn.propertyIsEnumerable,lr=nr.splice,Fo=Te?Te.isConcatSpreadable:i,Bn=Te?Te.iterator:i,Ne=Te?Te.toStringTag:i,cr=function(){try{var t=He(J,"defineProperty");return t({},"",{}),t}catch{}}(),ih=m.clearTimeout!==ht.clearTimeout&&m.clearTimeout,sh=T&&T.now!==ht.Date.now&&T.now,oh=m.setTimeout!==ht.setTimeout&&m.setTimeout,hr=ot.ceil,fr=ot.floor,Ci=J.getOwnPropertySymbols,uh=or?or.isBuffer:i,Uo=m.isFinite,ah=nr.join,lh=Lo(J.keys,J),ut=ot.max,dt=ot.min,ch=T.now,hh=m.parseInt,Ho=ot.random,fh=nr.reverse,Ei=He(m,"DataView"),Tn=He(m,"Map"),Pi=He(m,"Promise"),en=He(m,"Set"),An=He(m,"WeakMap"),Cn=He(J,"create"),pr=An&&new An,nn={},ph=Ge(Ei),dh=Ge(Tn),gh=Ge(Pi),_h=Ge(en),vh=Ge(An),dr=Te?Te.prototype:i,En=dr?dr.valueOf:i,Go=dr?dr.toString:i;function l(t){if(nt(t)&&!M(t)&&!(t instanceof G)){if(t instanceof Mt)return t;if(X.call(t,"__wrapped__"))return qu(t)}return new Mt(t)}var rn=function(){function t(){}return function(e){if(!et(e))return{};if(Do)return Do(e);t.prototype=e;var r=new t;return t.prototype=i,r}}();function gr(){}function Mt(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=i}l.templateSettings={escape:Rl,evaluate:Il,interpolate:Js,variable:"",imports:{_:l}},l.prototype=gr.prototype,l.prototype.constructor=l,Mt.prototype=rn(gr.prototype),Mt.prototype.constructor=Mt;function G(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Qt,this.__views__=[]}function mh(){var t=new G(this.__wrapped__);return t.__actions__=bt(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=bt(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=bt(this.__views__),t}function yh(){if(this.__filtered__){var t=new G(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function wh(){var t=this.__wrapped__.value(),e=this.__dir__,r=M(t),s=e<0,a=r?t.length:0,c=Lf(0,a,this.__views__),h=c.start,p=c.end,g=p-h,w=s?p:h-1,x=this.__iteratees__,S=x.length,B=0,C=dt(g,this.__takeCount__);if(!r||!s&&a==g&&C==g)return fu(t,this.__actions__);var R=[];t:for(;g--&&B<C;){w+=e;for(var W=-1,I=t[w];++W<S;){var H=x[W],q=H.iteratee,Ot=H.type,mt=q(I);if(Ot==dl)I=mt;else if(!mt){if(Ot==Ks)continue t;break t}}R[B++]=I}return R}G.prototype=rn(gr.prototype),G.prototype.constructor=G;function De(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var s=t[e];this.set(s[0],s[1])}}function xh(){this.__data__=Cn?Cn(null):{},this.size=0}function bh(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Sh(t){var e=this.__data__;if(Cn){var r=e[t];return r===L?i:r}return X.call(e,t)?e[t]:i}function Bh(t){var e=this.__data__;return Cn?e[t]!==i:X.call(e,t)}function Th(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Cn&&e===i?L:e,this}De.prototype.clear=xh,De.prototype.delete=bh,De.prototype.get=Sh,De.prototype.has=Bh,De.prototype.set=Th;function le(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var s=t[e];this.set(s[0],s[1])}}function Ah(){this.__data__=[],this.size=0}function Ch(t){var e=this.__data__,r=_r(e,t);if(r<0)return!1;var s=e.length-1;return r==s?e.pop():lr.call(e,r,1),--this.size,!0}function Eh(t){var e=this.__data__,r=_r(e,t);return r<0?i:e[r][1]}function Ph(t){return _r(this.__data__,t)>-1}function Oh(t,e){var r=this.__data__,s=_r(r,t);return s<0?(++this.size,r.push([t,e])):r[s][1]=e,this}le.prototype.clear=Ah,le.prototype.delete=Ch,le.prototype.get=Eh,le.prototype.has=Ph,le.prototype.set=Oh;function ce(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var s=t[e];this.set(s[0],s[1])}}function Rh(){this.size=0,this.__data__={hash:new De,map:new(Tn||le),string:new De}}function Ih(t){var e=Er(this,t).delete(t);return this.size-=e?1:0,e}function Lh(t){return Er(this,t).get(t)}function kh(t){return Er(this,t).has(t)}function Mh(t,e){var r=Er(this,t),s=r.size;return r.set(t,e),this.size+=r.size==s?0:1,this}ce.prototype.clear=Rh,ce.prototype.delete=Ih,ce.prototype.get=Lh,ce.prototype.has=kh,ce.prototype.set=Mh;function We(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new ce;++e<r;)this.add(t[e])}function Nh(t){return this.__data__.set(t,L),this}function Dh(t){return this.__data__.has(t)}We.prototype.add=We.prototype.push=Nh,We.prototype.has=Dh;function Xt(t){var e=this.__data__=new le(t);this.size=e.size}function Wh(){this.__data__=new le,this.size=0}function Fh(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function Uh(t){return this.__data__.get(t)}function Hh(t){return this.__data__.has(t)}function Gh(t,e){var r=this.__data__;if(r instanceof le){var s=r.__data__;if(!Tn||s.length<f-1)return s.push([t,e]),this.size=++r.size,this;r=this.__data__=new ce(s)}return r.set(t,e),this.size=r.size,this}Xt.prototype.clear=Wh,Xt.prototype.delete=Fh,Xt.prototype.get=Uh,Xt.prototype.has=Hh,Xt.prototype.set=Gh;function qo(t,e){var r=M(t),s=!r&&qe(t),a=!r&&!s&&Oe(t),c=!r&&!s&&!a&&an(t),h=r||s||a||c,p=h?Si(t.length,Qc):[],g=p.length;for(var w in t)(e||X.call(t,w))&&!(h&&(w=="length"||a&&(w=="offset"||w=="parent")||c&&(w=="buffer"||w=="byteLength"||w=="byteOffset")||de(w,g)))&&p.push(w);return p}function $o(t){var e=t.length;return e?t[Ui(0,e-1)]:i}function qh(t,e){return Pr(bt(t),Fe(e,0,t.length))}function $h(t){return Pr(bt(t))}function Oi(t,e,r){(r!==i&&!zt(t[e],r)||r===i&&!(e in t))&&he(t,e,r)}function Pn(t,e,r){var s=t[e];(!(X.call(t,e)&&zt(s,r))||r===i&&!(e in t))&&he(t,e,r)}function _r(t,e){for(var r=t.length;r--;)if(zt(t[r][0],e))return r;return-1}function Kh(t,e,r,s){return Ae(t,function(a,c,h){e(s,a,r(a),h)}),s}function Ko(t,e){return t&&te(e,at(e),t)}function Yh(t,e){return t&&te(e,Bt(e),t)}function he(t,e,r){e=="__proto__"&&cr?cr(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function Ri(t,e){for(var r=-1,s=e.length,a=v(s),c=t==null;++r<s;)a[r]=c?i:hs(t,e[r]);return a}function Fe(t,e,r){return t===t&&(r!==i&&(t=t<=r?t:r),e!==i&&(t=t>=e?t:e)),t}function Nt(t,e,r,s,a,c){var h,p=e&F,g=e&Zt,w=e&we;if(r&&(h=a?r(t,s,a,c):r(t)),h!==i)return h;if(!et(t))return t;var x=M(t);if(x){if(h=Mf(t),!p)return bt(t,h)}else{var S=gt(t),B=S==zn||S==Ys;if(Oe(t))return gu(t,p);if(S==ae||S==Xe||B&&!a){if(h=g||B?{}:ku(t),!p)return g?Bf(t,Yh(h,t)):Sf(t,Ko(h,t))}else{if(!Z[S])return a?t:{};h=Nf(t,S,p)}}c||(c=new Xt);var C=c.get(t);if(C)return C;c.set(t,h),la(t)?t.forEach(function(I){h.add(Nt(I,e,r,I,t,c))}):ua(t)&&t.forEach(function(I,H){h.set(H,Nt(I,e,r,H,t,c))});var R=w?g?Zi:Ji:g?Bt:at,W=x?i:R(t);return Lt(W||t,function(I,H){W&&(H=I,I=t[H]),Pn(h,H,Nt(I,e,r,H,t,c))}),h}function Xh(t){var e=at(t);return function(r){return Yo(r,t,e)}}function Yo(t,e,r){var s=r.length;if(t==null)return!s;for(t=J(t);s--;){var a=r[s],c=e[a],h=t[a];if(h===i&&!(a in t)||!c(h))return!1}return!0}function Xo(t,e,r){if(typeof t!="function")throw new kt(b);return Nn(function(){t.apply(i,r)},e)}function On(t,e,r,s){var a=-1,c=jn,h=!0,p=t.length,g=[],w=e.length;if(!p)return g;r&&(e=j(e,Ct(r))),s?(c=vi,h=!1):e.length>=f&&(c=Sn,h=!1,e=new We(e));t:for(;++a<p;){var x=t[a],S=r==null?x:r(x);if(x=s||x!==0?x:0,h&&S===S){for(var B=w;B--;)if(e[B]===S)continue t;g.push(x)}else c(e,S,s)||g.push(x)}return g}var Ae=wu(jt),zo=wu(Li,!0);function zh(t,e){var r=!0;return Ae(t,function(s,a,c){return r=!!e(s,a,c),r}),r}function vr(t,e,r){for(var s=-1,a=t.length;++s<a;){var c=t[s],h=e(c);if(h!=null&&(p===i?h===h&&!Pt(h):r(h,p)))var p=h,g=c}return g}function Vh(t,e,r,s){var a=t.length;for(r=N(r),r<0&&(r=-r>a?0:a+r),s=s===i||s>a?a:N(s),s<0&&(s+=a),s=r>s?0:ha(s);r<s;)t[r++]=e;return t}function Vo(t,e){var r=[];return Ae(t,function(s,a,c){e(s,a,c)&&r.push(s)}),r}function ft(t,e,r,s,a){var c=-1,h=t.length;for(r||(r=Wf),a||(a=[]);++c<h;){var p=t[c];e>0&&r(p)?e>1?ft(p,e-1,r,s,a):Se(a,p):s||(a[a.length]=p)}return a}var Ii=xu(),Jo=xu(!0);function jt(t,e){return t&&Ii(t,e,at)}function Li(t,e){return t&&Jo(t,e,at)}function mr(t,e){return be(e,function(r){return ge(t[r])})}function Ue(t,e){e=Ee(e,t);for(var r=0,s=e.length;t!=null&&r<s;)t=t[ee(e[r++])];return r&&r==s?t:i}function Zo(t,e,r){var s=e(t);return M(t)?s:Se(s,r(t))}function _t(t){return t==null?t===i?Bl:bl:Ne&&Ne in J(t)?If(t):Kf(t)}function ki(t,e){return t>e}function Jh(t,e){return t!=null&&X.call(t,e)}function Zh(t,e){return t!=null&&e in J(t)}function Qh(t,e,r){return t>=dt(e,r)&&t<ut(e,r)}function Mi(t,e,r){for(var s=r?vi:jn,a=t[0].length,c=t.length,h=c,p=v(c),g=1/0,w=[];h--;){var x=t[h];h&&e&&(x=j(x,Ct(e))),g=dt(x.length,g),p[h]=!r&&(e||a>=120&&x.length>=120)?new We(h&&x):i}x=t[0];var S=-1,B=p[0];t:for(;++S<a&&w.length<g;){var C=x[S],R=e?e(C):C;if(C=r||C!==0?C:0,!(B?Sn(B,R):s(w,R,r))){for(h=c;--h;){var W=p[h];if(!(W?Sn(W,R):s(t[h],R,r)))continue t}B&&B.push(R),w.push(C)}}return w}function jh(t,e,r,s){return jt(t,function(a,c,h){e(s,r(a),c,h)}),s}function Rn(t,e,r){e=Ee(e,t),t=Wu(t,e);var s=t==null?t:t[ee(Wt(e))];return s==null?i:At(s,t,r)}function Qo(t){return nt(t)&&_t(t)==Xe}function tf(t){return nt(t)&&_t(t)==bn}function ef(t){return nt(t)&&_t(t)==vn}function In(t,e,r,s,a){return t===e?!0:t==null||e==null||!nt(t)&&!nt(e)?t!==t&&e!==e:nf(t,e,r,s,In,a)}function nf(t,e,r,s,a,c){var h=M(t),p=M(e),g=h?Yn:gt(t),w=p?Yn:gt(e);g=g==Xe?ae:g,w=w==Xe?ae:w;var x=g==ae,S=w==ae,B=g==w;if(B&&Oe(t)){if(!Oe(e))return!1;h=!0,x=!1}if(B&&!x)return c||(c=new Xt),h||an(t)?Ru(t,e,r,s,a,c):Of(t,e,g,r,s,a,c);if(!(r&xe)){var C=x&&X.call(t,"__wrapped__"),R=S&&X.call(e,"__wrapped__");if(C||R){var W=C?t.value():t,I=R?e.value():e;return c||(c=new Xt),a(W,I,r,s,c)}}return B?(c||(c=new Xt),Rf(t,e,r,s,a,c)):!1}function rf(t){return nt(t)&&gt(t)==$t}function Ni(t,e,r,s){var a=r.length,c=a,h=!s;if(t==null)return!c;for(t=J(t);a--;){var p=r[a];if(h&&p[2]?p[1]!==t[p[0]]:!(p[0]in t))return!1}for(;++a<c;){p=r[a];var g=p[0],w=t[g],x=p[1];if(h&&p[2]){if(w===i&&!(g in t))return!1}else{var S=new Xt;if(s)var B=s(w,x,g,t,e,S);if(!(B===i?In(x,w,xe|$e,s,S):B))return!1}}return!0}function jo(t){if(!et(t)||Uf(t))return!1;var e=ge(t)?rh:Xl;return e.test(Ge(t))}function sf(t){return nt(t)&&_t(t)==yn}function of(t){return nt(t)&&gt(t)==Kt}function uf(t){return nt(t)&&Mr(t.length)&&!!Q[_t(t)]}function tu(t){return typeof t=="function"?t:t==null?Tt:typeof t=="object"?M(t)?ru(t[0],t[1]):nu(t):ba(t)}function Di(t){if(!Mn(t))return lh(t);var e=[];for(var r in J(t))X.call(t,r)&&r!="constructor"&&e.push(r);return e}function af(t){if(!et(t))return $f(t);var e=Mn(t),r=[];for(var s in t)s=="constructor"&&(e||!X.call(t,s))||r.push(s);return r}function Wi(t,e){return t<e}function eu(t,e){var r=-1,s=St(t)?v(t.length):[];return Ae(t,function(a,c,h){s[++r]=e(a,c,h)}),s}function nu(t){var e=ji(t);return e.length==1&&e[0][2]?Nu(e[0][0],e[0][1]):function(r){return r===t||Ni(r,t,e)}}function ru(t,e){return es(t)&&Mu(e)?Nu(ee(t),e):function(r){var s=hs(r,t);return s===i&&s===e?fs(r,t):In(e,s,xe|$e)}}function yr(t,e,r,s,a){t!==e&&Ii(e,function(c,h){if(a||(a=new Xt),et(c))lf(t,e,h,r,yr,s,a);else{var p=s?s(rs(t,h),c,h+"",t,e,a):i;p===i&&(p=c),Oi(t,h,p)}},Bt)}function lf(t,e,r,s,a,c,h){var p=rs(t,r),g=rs(e,r),w=h.get(g);if(w){Oi(t,r,w);return}var x=c?c(p,g,r+"",t,e,h):i,S=x===i;if(S){var B=M(g),C=!B&&Oe(g),R=!B&&!C&&an(g);x=g,B||C||R?M(p)?x=p:rt(p)?x=bt(p):C?(S=!1,x=gu(g,!0)):R?(S=!1,x=_u(g,!0)):x=[]:Dn(g)||qe(g)?(x=p,qe(p)?x=fa(p):(!et(p)||ge(p))&&(x=ku(g))):S=!1}S&&(h.set(g,x),a(x,g,s,c,h),h.delete(g)),Oi(t,r,x)}function iu(t,e){var r=t.length;if(r)return e+=e<0?r:0,de(e,r)?t[e]:i}function su(t,e,r){e.length?e=j(e,function(c){return M(c)?function(h){return Ue(h,c.length===1?c[0]:c)}:c}):e=[Tt];var s=-1;e=j(e,Ct(O()));var a=eu(t,function(c,h,p){var g=j(e,function(w){return w(c)});return{criteria:g,index:++s,value:c}});return Mc(a,function(c,h){return bf(c,h,r)})}function cf(t,e){return ou(t,e,function(r,s){return fs(t,s)})}function ou(t,e,r){for(var s=-1,a=e.length,c={};++s<a;){var h=e[s],p=Ue(t,h);r(p,h)&&Ln(c,Ee(h,t),p)}return c}function hf(t){return function(e){return Ue(e,t)}}function Fi(t,e,r,s){var a=s?kc:Je,c=-1,h=e.length,p=t;for(t===e&&(e=bt(e)),r&&(p=j(t,Ct(r)));++c<h;)for(var g=0,w=e[c],x=r?r(w):w;(g=a(p,x,g,s))>-1;)p!==t&&lr.call(p,g,1),lr.call(t,g,1);return t}function uu(t,e){for(var r=t?e.length:0,s=r-1;r--;){var a=e[r];if(r==s||a!==c){var c=a;de(a)?lr.call(t,a,1):qi(t,a)}}return t}function Ui(t,e){return t+fr(Ho()*(e-t+1))}function ff(t,e,r,s){for(var a=-1,c=ut(hr((e-t)/(r||1)),0),h=v(c);c--;)h[s?c:++a]=t,t+=r;return h}function Hi(t,e){var r="";if(!t||e<1||e>Ye)return r;do e%2&&(r+=t),e=fr(e/2),e&&(t+=t);while(e);return r}function U(t,e){return is(Du(t,e,Tt),t+"")}function pf(t){return $o(ln(t))}function df(t,e){var r=ln(t);return Pr(r,Fe(e,0,r.length))}function Ln(t,e,r,s){if(!et(t))return t;e=Ee(e,t);for(var a=-1,c=e.length,h=c-1,p=t;p!=null&&++a<c;){var g=ee(e[a]),w=r;if(g==="__proto__"||g==="constructor"||g==="prototype")return t;if(a!=h){var x=p[g];w=s?s(x,g,p):i,w===i&&(w=et(x)?x:de(e[a+1])?[]:{})}Pn(p,g,w),p=p[g]}return t}var au=pr?function(t,e){return pr.set(t,e),t}:Tt,gf=cr?function(t,e){return cr(t,"toString",{configurable:!0,enumerable:!1,value:ds(e),writable:!0})}:Tt;function _f(t){return Pr(ln(t))}function Dt(t,e,r){var s=-1,a=t.length;e<0&&(e=-e>a?0:a+e),r=r>a?a:r,r<0&&(r+=a),a=e>r?0:r-e>>>0,e>>>=0;for(var c=v(a);++s<a;)c[s]=t[s+e];return c}function vf(t,e){var r;return Ae(t,function(s,a,c){return r=e(s,a,c),!r}),!!r}function wr(t,e,r){var s=0,a=t==null?s:t.length;if(typeof e=="number"&&e===e&&a<=ml){for(;s<a;){var c=s+a>>>1,h=t[c];h!==null&&!Pt(h)&&(r?h<=e:h<e)?s=c+1:a=c}return a}return Gi(t,e,Tt,r)}function Gi(t,e,r,s){var a=0,c=t==null?0:t.length;if(c===0)return 0;e=r(e);for(var h=e!==e,p=e===null,g=Pt(e),w=e===i;a<c;){var x=fr((a+c)/2),S=r(t[x]),B=S!==i,C=S===null,R=S===S,W=Pt(S);if(h)var I=s||R;else w?I=R&&(s||B):p?I=R&&B&&(s||!C):g?I=R&&B&&!C&&(s||!W):C||W?I=!1:I=s?S<=e:S<e;I?a=x+1:c=x}return dt(c,vl)}function lu(t,e){for(var r=-1,s=t.length,a=0,c=[];++r<s;){var h=t[r],p=e?e(h):h;if(!r||!zt(p,g)){var g=p;c[a++]=h===0?0:h}}return c}function cu(t){return typeof t=="number"?t:Pt(t)?Kn:+t}function Et(t){if(typeof t=="string")return t;if(M(t))return j(t,Et)+"";if(Pt(t))return Go?Go.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function Ce(t,e,r){var s=-1,a=jn,c=t.length,h=!0,p=[],g=p;if(r)h=!1,a=vi;else if(c>=f){var w=e?null:Ef(t);if(w)return er(w);h=!1,a=Sn,g=new We}else g=e?[]:p;t:for(;++s<c;){var x=t[s],S=e?e(x):x;if(x=r||x!==0?x:0,h&&S===S){for(var B=g.length;B--;)if(g[B]===S)continue t;e&&g.push(S),p.push(x)}else a(g,S,r)||(g!==p&&g.push(S),p.push(x))}return p}function qi(t,e){return e=Ee(e,t),t=Wu(t,e),t==null||delete t[ee(Wt(e))]}function hu(t,e,r,s){return Ln(t,e,r(Ue(t,e)),s)}function xr(t,e,r,s){for(var a=t.length,c=s?a:-1;(s?c--:++c<a)&&e(t[c],c,t););return r?Dt(t,s?0:c,s?c+1:a):Dt(t,s?c+1:0,s?a:c)}function fu(t,e){var r=t;return r instanceof G&&(r=r.value()),mi(e,function(s,a){return a.func.apply(a.thisArg,Se([s],a.args))},r)}function $i(t,e,r){var s=t.length;if(s<2)return s?Ce(t[0]):[];for(var a=-1,c=v(s);++a<s;)for(var h=t[a],p=-1;++p<s;)p!=a&&(c[a]=On(c[a]||h,t[p],e,r));return Ce(ft(c,1),e,r)}function pu(t,e,r){for(var s=-1,a=t.length,c=e.length,h={};++s<a;){var p=s<c?e[s]:i;r(h,t[s],p)}return h}function Ki(t){return rt(t)?t:[]}function Yi(t){return typeof t=="function"?t:Tt}function Ee(t,e){return M(t)?t:es(t,e)?[t]:Gu(Y(t))}var mf=U;function Pe(t,e,r){var s=t.length;return r=r===i?s:r,!e&&r>=s?t:Dt(t,e,r)}var du=ih||function(t){return ht.clearTimeout(t)};function gu(t,e){if(e)return t.slice();var r=t.length,s=No?No(r):new t.constructor(r);return t.copy(s),s}function Xi(t){var e=new t.constructor(t.byteLength);return new ur(e).set(new ur(t)),e}function yf(t,e){var r=e?Xi(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}function wf(t){var e=new t.constructor(t.source,Zs.exec(t));return e.lastIndex=t.lastIndex,e}function xf(t){return En?J(En.call(t)):{}}function _u(t,e){var r=e?Xi(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}function vu(t,e){if(t!==e){var r=t!==i,s=t===null,a=t===t,c=Pt(t),h=e!==i,p=e===null,g=e===e,w=Pt(e);if(!p&&!w&&!c&&t>e||c&&h&&g&&!p&&!w||s&&h&&g||!r&&g||!a)return 1;if(!s&&!c&&!w&&t<e||w&&r&&a&&!s&&!c||p&&r&&a||!h&&a||!g)return-1}return 0}function bf(t,e,r){for(var s=-1,a=t.criteria,c=e.criteria,h=a.length,p=r.length;++s<h;){var g=vu(a[s],c[s]);if(g){if(s>=p)return g;var w=r[s];return g*(w=="desc"?-1:1)}}return t.index-e.index}function mu(t,e,r,s){for(var a=-1,c=t.length,h=r.length,p=-1,g=e.length,w=ut(c-h,0),x=v(g+w),S=!s;++p<g;)x[p]=e[p];for(;++a<h;)(S||a<c)&&(x[r[a]]=t[a]);for(;w--;)x[p++]=t[a++];return x}function yu(t,e,r,s){for(var a=-1,c=t.length,h=-1,p=r.length,g=-1,w=e.length,x=ut(c-p,0),S=v(x+w),B=!s;++a<x;)S[a]=t[a];for(var C=a;++g<w;)S[C+g]=e[g];for(;++h<p;)(B||a<c)&&(S[C+r[h]]=t[a++]);return S}function bt(t,e){var r=-1,s=t.length;for(e||(e=v(s));++r<s;)e[r]=t[r];return e}function te(t,e,r,s){var a=!r;r||(r={});for(var c=-1,h=e.length;++c<h;){var p=e[c],g=s?s(r[p],t[p],p,r,t):i;g===i&&(g=t[p]),a?he(r,p,g):Pn(r,p,g)}return r}function Sf(t,e){return te(t,ts(t),e)}function Bf(t,e){return te(t,Iu(t),e)}function br(t,e){return function(r,s){var a=M(r)?Ec:Kh,c=e?e():{};return a(r,t,O(s,2),c)}}function sn(t){return U(function(e,r){var s=-1,a=r.length,c=a>1?r[a-1]:i,h=a>2?r[2]:i;for(c=t.length>3&&typeof c=="function"?(a--,c):i,h&&vt(r[0],r[1],h)&&(c=a<3?i:c,a=1),e=J(e);++s<a;){var p=r[s];p&&t(e,p,s,c)}return e})}function wu(t,e){return function(r,s){if(r==null)return r;if(!St(r))return t(r,s);for(var a=r.length,c=e?a:-1,h=J(r);(e?c--:++c<a)&&s(h[c],c,h)!==!1;);return r}}function xu(t){return function(e,r,s){for(var a=-1,c=J(e),h=s(e),p=h.length;p--;){var g=h[t?p:++a];if(r(c[g],g,c)===!1)break}return e}}function Tf(t,e,r){var s=e&qt,a=kn(t);function c(){var h=this&&this!==ht&&this instanceof c?a:t;return h.apply(s?r:this,arguments)}return c}function bu(t){return function(e){e=Y(e);var r=Ze(e)?Yt(e):i,s=r?r[0]:e.charAt(0),a=r?Pe(r,1).join(""):e.slice(1);return s[t]()+a}}function on(t){return function(e){return mi(wa(ya(e).replace(dc,"")),t,"")}}function kn(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var r=rn(t.prototype),s=t.apply(r,e);return et(s)?s:r}}function Af(t,e,r){var s=kn(t);function a(){for(var c=arguments.length,h=v(c),p=c,g=un(a);p--;)h[p]=arguments[p];var w=c<3&&h[0]!==g&&h[c-1]!==g?[]:Be(h,g);if(c-=w.length,c<r)return Cu(t,e,Sr,a.placeholder,i,h,w,i,i,r-c);var x=this&&this!==ht&&this instanceof a?s:t;return At(x,this,h)}return a}function Su(t){return function(e,r,s){var a=J(e);if(!St(e)){var c=O(r,3);e=at(e),r=function(p){return c(a[p],p,a)}}var h=t(e,r,s);return h>-1?a[c?e[h]:h]:i}}function Bu(t){return pe(function(e){var r=e.length,s=r,a=Mt.prototype.thru;for(t&&e.reverse();s--;){var c=e[s];if(typeof c!="function")throw new kt(b);if(a&&!h&&Cr(c)=="wrapper")var h=new Mt([],!0)}for(s=h?s:r;++s<r;){c=e[s];var p=Cr(c),g=p=="wrapper"?Qi(c):i;g&&ns(g[0])&&g[1]==(ue|se|oe|gn)&&!g[4].length&&g[9]==1?h=h[Cr(g[0])].apply(h,g[3]):h=c.length==1&&ns(c)?h[p]():h.thru(c)}return function(){var w=arguments,x=w[0];if(h&&w.length==1&&M(x))return h.plant(x).value();for(var S=0,B=r?e[S].apply(this,w):x;++S<r;)B=e[S].call(this,B);return B}})}function Sr(t,e,r,s,a,c,h,p,g,w){var x=e&ue,S=e&qt,B=e&Ke,C=e&(se|pn),R=e&Qr,W=B?i:kn(t);function I(){for(var H=arguments.length,q=v(H),Ot=H;Ot--;)q[Ot]=arguments[Ot];if(C)var mt=un(I),Rt=Dc(q,mt);if(s&&(q=mu(q,s,a,C)),c&&(q=yu(q,c,h,C)),H-=Rt,C&&H<w){var it=Be(q,mt);return Cu(t,e,Sr,I.placeholder,r,q,it,p,g,w-H)}var Vt=S?r:this,ve=B?Vt[t]:t;return H=q.length,p?q=Yf(q,p):R&&H>1&&q.reverse(),x&&g<H&&(q.length=g),this&&this!==ht&&this instanceof I&&(ve=W||kn(ve)),ve.apply(Vt,q)}return I}function Tu(t,e){return function(r,s){return jh(r,t,e(s),{})}}function Br(t,e){return function(r,s){var a;if(r===i&&s===i)return e;if(r!==i&&(a=r),s!==i){if(a===i)return s;typeof r=="string"||typeof s=="string"?(r=Et(r),s=Et(s)):(r=cu(r),s=cu(s)),a=t(r,s)}return a}}function zi(t){return pe(function(e){return e=j(e,Ct(O())),U(function(r){var s=this;return t(e,function(a){return At(a,s,r)})})})}function Tr(t,e){e=e===i?" ":Et(e);var r=e.length;if(r<2)return r?Hi(e,t):e;var s=Hi(e,hr(t/Qe(e)));return Ze(e)?Pe(Yt(s),0,t).join(""):s.slice(0,t)}function Cf(t,e,r,s){var a=e&qt,c=kn(t);function h(){for(var p=-1,g=arguments.length,w=-1,x=s.length,S=v(x+g),B=this&&this!==ht&&this instanceof h?c:t;++w<x;)S[w]=s[w];for(;g--;)S[w++]=arguments[++p];return At(B,a?r:this,S)}return h}function Au(t){return function(e,r,s){return s&&typeof s!="number"&&vt(e,r,s)&&(r=s=i),e=_e(e),r===i?(r=e,e=0):r=_e(r),s=s===i?e<r?1:-1:_e(s),ff(e,r,s,t)}}function Ar(t){return function(e,r){return typeof e=="string"&&typeof r=="string"||(e=Ft(e),r=Ft(r)),t(e,r)}}function Cu(t,e,r,s,a,c,h,p,g,w){var x=e&se,S=x?h:i,B=x?i:h,C=x?c:i,R=x?i:c;e|=x?oe:dn,e&=~(x?dn:oe),e&$s||(e&=-4);var W=[t,e,a,C,S,R,B,p,g,w],I=r.apply(i,W);return ns(t)&&Fu(I,W),I.placeholder=s,Uu(I,t,e)}function Vi(t){var e=ot[t];return function(r,s){if(r=Ft(r),s=s==null?0:dt(N(s),292),s&&Uo(r)){var a=(Y(r)+"e").split("e"),c=e(a[0]+"e"+(+a[1]+s));return a=(Y(c)+"e").split("e"),+(a[0]+"e"+(+a[1]-s))}return e(r)}}var Ef=en&&1/er(new en([,-0]))[1]==$n?function(t){return new en(t)}:vs;function Eu(t){return function(e){var r=gt(e);return r==$t?Ti(e):r==Kt?$c(e):Nc(e,t(e))}}function fe(t,e,r,s,a,c,h,p){var g=e&Ke;if(!g&&typeof t!="function")throw new kt(b);var w=s?s.length:0;if(w||(e&=-97,s=a=i),h=h===i?h:ut(N(h),0),p=p===i?p:N(p),w-=a?a.length:0,e&dn){var x=s,S=a;s=a=i}var B=g?i:Qi(t),C=[t,e,r,s,a,x,S,c,h,p];if(B&&qf(C,B),t=C[0],e=C[1],r=C[2],s=C[3],a=C[4],p=C[9]=C[9]===i?g?0:t.length:ut(C[9]-w,0),!p&&e&(se|pn)&&(e&=-25),!e||e==qt)var R=Tf(t,e,r);else e==se||e==pn?R=Af(t,e,p):(e==oe||e==(qt|oe))&&!a.length?R=Cf(t,e,r,s):R=Sr.apply(i,C);var W=B?au:Fu;return Uu(W(R,C),t,e)}function Pu(t,e,r,s){return t===i||zt(t,tn[r])&&!X.call(s,r)?e:t}function Ou(t,e,r,s,a,c){return et(t)&&et(e)&&(c.set(e,t),yr(t,e,i,Ou,c),c.delete(e)),t}function Pf(t){return Dn(t)?i:t}function Ru(t,e,r,s,a,c){var h=r&xe,p=t.length,g=e.length;if(p!=g&&!(h&&g>p))return!1;var w=c.get(t),x=c.get(e);if(w&&x)return w==e&&x==t;var S=-1,B=!0,C=r&$e?new We:i;for(c.set(t,e),c.set(e,t);++S<p;){var R=t[S],W=e[S];if(s)var I=h?s(W,R,S,e,t,c):s(R,W,S,t,e,c);if(I!==i){if(I)continue;B=!1;break}if(C){if(!yi(e,function(H,q){if(!Sn(C,q)&&(R===H||a(R,H,r,s,c)))return C.push(q)})){B=!1;break}}else if(!(R===W||a(R,W,r,s,c))){B=!1;break}}return c.delete(t),c.delete(e),B}function Of(t,e,r,s,a,c,h){switch(r){case ze:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case bn:return!(t.byteLength!=e.byteLength||!c(new ur(t),new ur(e)));case _n:case vn:case mn:return zt(+t,+e);case Xn:return t.name==e.name&&t.message==e.message;case yn:case wn:return t==e+"";case $t:var p=Ti;case Kt:var g=s&xe;if(p||(p=er),t.size!=e.size&&!g)return!1;var w=h.get(t);if(w)return w==e;s|=$e,h.set(t,e);var x=Ru(p(t),p(e),s,a,c,h);return h.delete(t),x;case Vn:if(En)return En.call(t)==En.call(e)}return!1}function Rf(t,e,r,s,a,c){var h=r&xe,p=Ji(t),g=p.length,w=Ji(e),x=w.length;if(g!=x&&!h)return!1;for(var S=g;S--;){var B=p[S];if(!(h?B in e:X.call(e,B)))return!1}var C=c.get(t),R=c.get(e);if(C&&R)return C==e&&R==t;var W=!0;c.set(t,e),c.set(e,t);for(var I=h;++S<g;){B=p[S];var H=t[B],q=e[B];if(s)var Ot=h?s(q,H,B,e,t,c):s(H,q,B,t,e,c);if(!(Ot===i?H===q||a(H,q,r,s,c):Ot)){W=!1;break}I||(I=B=="constructor")}if(W&&!I){var mt=t.constructor,Rt=e.constructor;mt!=Rt&&"constructor"in t&&"constructor"in e&&!(typeof mt=="function"&&mt instanceof mt&&typeof Rt=="function"&&Rt instanceof Rt)&&(W=!1)}return c.delete(t),c.delete(e),W}function pe(t){return is(Du(t,i,Yu),t+"")}function Ji(t){return Zo(t,at,ts)}function Zi(t){return Zo(t,Bt,Iu)}var Qi=pr?function(t){return pr.get(t)}:vs;function Cr(t){for(var e=t.name+"",r=nn[e],s=X.call(nn,e)?r.length:0;s--;){var a=r[s],c=a.func;if(c==null||c==t)return a.name}return e}function un(t){var e=X.call(l,"placeholder")?l:t;return e.placeholder}function O(){var t=l.iteratee||gs;return t=t===gs?tu:t,arguments.length?t(arguments[0],arguments[1]):t}function Er(t,e){var r=t.__data__;return Ff(e)?r[typeof e=="string"?"string":"hash"]:r.map}function ji(t){for(var e=at(t),r=e.length;r--;){var s=e[r],a=t[s];e[r]=[s,a,Mu(a)]}return e}function He(t,e){var r=Hc(t,e);return jo(r)?r:i}function If(t){var e=X.call(t,Ne),r=t[Ne];try{t[Ne]=i;var s=!0}catch{}var a=sr.call(t);return s&&(e?t[Ne]=r:delete t[Ne]),a}var ts=Ci?function(t){return t==null?[]:(t=J(t),be(Ci(t),function(e){return Wo.call(t,e)}))}:ms,Iu=Ci?function(t){for(var e=[];t;)Se(e,ts(t)),t=ar(t);return e}:ms,gt=_t;(Ei&&gt(new Ei(new ArrayBuffer(1)))!=ze||Tn&&gt(new Tn)!=$t||Pi&&gt(Pi.resolve())!=Xs||en&&gt(new en)!=Kt||An&&gt(new An)!=xn)&&(gt=function(t){var e=_t(t),r=e==ae?t.constructor:i,s=r?Ge(r):"";if(s)switch(s){case ph:return ze;case dh:return $t;case gh:return Xs;case _h:return Kt;case vh:return xn}return e});function Lf(t,e,r){for(var s=-1,a=r.length;++s<a;){var c=r[s],h=c.size;switch(c.type){case"drop":t+=h;break;case"dropRight":e-=h;break;case"take":e=dt(e,t+h);break;case"takeRight":t=ut(t,e-h);break}}return{start:t,end:e}}function kf(t){var e=t.match(Fl);return e?e[1].split(Ul):[]}function Lu(t,e,r){e=Ee(e,t);for(var s=-1,a=e.length,c=!1;++s<a;){var h=ee(e[s]);if(!(c=t!=null&&r(t,h)))break;t=t[h]}return c||++s!=a?c:(a=t==null?0:t.length,!!a&&Mr(a)&&de(h,a)&&(M(t)||qe(t)))}function Mf(t){var e=t.length,r=new t.constructor(e);return e&&typeof t[0]=="string"&&X.call(t,"index")&&(r.index=t.index,r.input=t.input),r}function ku(t){return typeof t.constructor=="function"&&!Mn(t)?rn(ar(t)):{}}function Nf(t,e,r){var s=t.constructor;switch(e){case bn:return Xi(t);case _n:case vn:return new s(+t);case ze:return yf(t,r);case jr:case ti:case ei:case ni:case ri:case ii:case si:case oi:case ui:return _u(t,r);case $t:return new s;case mn:case wn:return new s(t);case yn:return wf(t);case Kt:return new s;case Vn:return xf(t)}}function Df(t,e){var r=e.length;if(!r)return t;var s=r-1;return e[s]=(r>1?"& ":"")+e[s],e=e.join(r>2?", ":" "),t.replace(Wl,`{
/* [wrapped with `+e+`] */
`)}function Wf(t){return M(t)||qe(t)||!!(Fo&&t&&t[Fo])}function de(t,e){var r=typeof t;return e=e??Ye,!!e&&(r=="number"||r!="symbol"&&Vl.test(t))&&t>-1&&t%1==0&&t<e}function vt(t,e,r){if(!et(r))return!1;var s=typeof e;return(s=="number"?St(r)&&de(e,r.length):s=="string"&&e in r)?zt(r[e],t):!1}function es(t,e){if(M(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||Pt(t)?!0:kl.test(t)||!Ll.test(t)||e!=null&&t in J(e)}function Ff(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function ns(t){var e=Cr(t),r=l[e];if(typeof r!="function"||!(e in G.prototype))return!1;if(t===r)return!0;var s=Qi(r);return!!s&&t===s[0]}function Uf(t){return!!Mo&&Mo in t}var Hf=rr?ge:ys;function Mn(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||tn;return t===r}function Mu(t){return t===t&&!et(t)}function Nu(t,e){return function(r){return r==null?!1:r[t]===e&&(e!==i||t in J(r))}}function Gf(t){var e=Lr(t,function(s){return r.size===ct&&r.clear(),s}),r=e.cache;return e}function qf(t,e){var r=t[1],s=e[1],a=r|s,c=a<(qt|Ke|ue),h=s==ue&&r==se||s==ue&&r==gn&&t[7].length<=e[8]||s==(ue|gn)&&e[7].length<=e[8]&&r==se;if(!(c||h))return t;s&qt&&(t[2]=e[2],a|=r&qt?0:$s);var p=e[3];if(p){var g=t[3];t[3]=g?mu(g,p,e[4]):p,t[4]=g?Be(t[3],tt):e[4]}return p=e[5],p&&(g=t[5],t[5]=g?yu(g,p,e[6]):p,t[6]=g?Be(t[5],tt):e[6]),p=e[7],p&&(t[7]=p),s&ue&&(t[8]=t[8]==null?e[8]:dt(t[8],e[8])),t[9]==null&&(t[9]=e[9]),t[0]=e[0],t[1]=a,t}function $f(t){var e=[];if(t!=null)for(var r in J(t))e.push(r);return e}function Kf(t){return sr.call(t)}function Du(t,e,r){return e=ut(e===i?t.length-1:e,0),function(){for(var s=arguments,a=-1,c=ut(s.length-e,0),h=v(c);++a<c;)h[a]=s[e+a];a=-1;for(var p=v(e+1);++a<e;)p[a]=s[a];return p[e]=r(h),At(t,this,p)}}function Wu(t,e){return e.length<2?t:Ue(t,Dt(e,0,-1))}function Yf(t,e){for(var r=t.length,s=dt(e.length,r),a=bt(t);s--;){var c=e[s];t[s]=de(c,r)?a[c]:i}return t}function rs(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var Fu=Hu(au),Nn=oh||function(t,e){return ht.setTimeout(t,e)},is=Hu(gf);function Uu(t,e,r){var s=e+"";return is(t,Df(s,Xf(kf(s),r)))}function Hu(t){var e=0,r=0;return function(){var s=ch(),a=pl-(s-r);if(r=s,a>0){if(++e>=fl)return arguments[0]}else e=0;return t.apply(i,arguments)}}function Pr(t,e){var r=-1,s=t.length,a=s-1;for(e=e===i?s:e;++r<e;){var c=Ui(r,a),h=t[c];t[c]=t[r],t[r]=h}return t.length=e,t}var Gu=Gf(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Ml,function(r,s,a,c){e.push(a?c.replace(ql,"$1"):s||r)}),e});function ee(t){if(typeof t=="string"||Pt(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function Ge(t){if(t!=null){try{return ir.call(t)}catch{}try{return t+""}catch{}}return""}function Xf(t,e){return Lt(yl,function(r){var s="_."+r[0];e&r[1]&&!jn(t,s)&&t.push(s)}),t.sort()}function qu(t){if(t instanceof G)return t.clone();var e=new Mt(t.__wrapped__,t.__chain__);return e.__actions__=bt(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function zf(t,e,r){(r?vt(t,e,r):e===i)?e=1:e=ut(N(e),0);var s=t==null?0:t.length;if(!s||e<1)return[];for(var a=0,c=0,h=v(hr(s/e));a<s;)h[c++]=Dt(t,a,a+=e);return h}function Vf(t){for(var e=-1,r=t==null?0:t.length,s=0,a=[];++e<r;){var c=t[e];c&&(a[s++]=c)}return a}function Jf(){var t=arguments.length;if(!t)return[];for(var e=v(t-1),r=arguments[0],s=t;s--;)e[s-1]=arguments[s];return Se(M(r)?bt(r):[r],ft(e,1))}var Zf=U(function(t,e){return rt(t)?On(t,ft(e,1,rt,!0)):[]}),Qf=U(function(t,e){var r=Wt(e);return rt(r)&&(r=i),rt(t)?On(t,ft(e,1,rt,!0),O(r,2)):[]}),jf=U(function(t,e){var r=Wt(e);return rt(r)&&(r=i),rt(t)?On(t,ft(e,1,rt,!0),i,r):[]});function tp(t,e,r){var s=t==null?0:t.length;return s?(e=r||e===i?1:N(e),Dt(t,e<0?0:e,s)):[]}function ep(t,e,r){var s=t==null?0:t.length;return s?(e=r||e===i?1:N(e),e=s-e,Dt(t,0,e<0?0:e)):[]}function np(t,e){return t&&t.length?xr(t,O(e,3),!0,!0):[]}function rp(t,e){return t&&t.length?xr(t,O(e,3),!0):[]}function ip(t,e,r,s){var a=t==null?0:t.length;return a?(r&&typeof r!="number"&&vt(t,e,r)&&(r=0,s=a),Vh(t,e,r,s)):[]}function $u(t,e,r){var s=t==null?0:t.length;if(!s)return-1;var a=r==null?0:N(r);return a<0&&(a=ut(s+a,0)),tr(t,O(e,3),a)}function Ku(t,e,r){var s=t==null?0:t.length;if(!s)return-1;var a=s-1;return r!==i&&(a=N(r),a=r<0?ut(s+a,0):dt(a,s-1)),tr(t,O(e,3),a,!0)}function Yu(t){var e=t==null?0:t.length;return e?ft(t,1):[]}function sp(t){var e=t==null?0:t.length;return e?ft(t,$n):[]}function op(t,e){var r=t==null?0:t.length;return r?(e=e===i?1:N(e),ft(t,e)):[]}function up(t){for(var e=-1,r=t==null?0:t.length,s={};++e<r;){var a=t[e];s[a[0]]=a[1]}return s}function Xu(t){return t&&t.length?t[0]:i}function ap(t,e,r){var s=t==null?0:t.length;if(!s)return-1;var a=r==null?0:N(r);return a<0&&(a=ut(s+a,0)),Je(t,e,a)}function lp(t){var e=t==null?0:t.length;return e?Dt(t,0,-1):[]}var cp=U(function(t){var e=j(t,Ki);return e.length&&e[0]===t[0]?Mi(e):[]}),hp=U(function(t){var e=Wt(t),r=j(t,Ki);return e===Wt(r)?e=i:r.pop(),r.length&&r[0]===t[0]?Mi(r,O(e,2)):[]}),fp=U(function(t){var e=Wt(t),r=j(t,Ki);return e=typeof e=="function"?e:i,e&&r.pop(),r.length&&r[0]===t[0]?Mi(r,i,e):[]});function pp(t,e){return t==null?"":ah.call(t,e)}function Wt(t){var e=t==null?0:t.length;return e?t[e-1]:i}function dp(t,e,r){var s=t==null?0:t.length;if(!s)return-1;var a=s;return r!==i&&(a=N(r),a=a<0?ut(s+a,0):dt(a,s-1)),e===e?Yc(t,e,a):tr(t,Co,a,!0)}function gp(t,e){return t&&t.length?iu(t,N(e)):i}var _p=U(zu);function zu(t,e){return t&&t.length&&e&&e.length?Fi(t,e):t}function vp(t,e,r){return t&&t.length&&e&&e.length?Fi(t,e,O(r,2)):t}function mp(t,e,r){return t&&t.length&&e&&e.length?Fi(t,e,i,r):t}var yp=pe(function(t,e){var r=t==null?0:t.length,s=Ri(t,e);return uu(t,j(e,function(a){return de(a,r)?+a:a}).sort(vu)),s});function wp(t,e){var r=[];if(!(t&&t.length))return r;var s=-1,a=[],c=t.length;for(e=O(e,3);++s<c;){var h=t[s];e(h,s,t)&&(r.push(h),a.push(s))}return uu(t,a),r}function ss(t){return t==null?t:fh.call(t)}function xp(t,e,r){var s=t==null?0:t.length;return s?(r&&typeof r!="number"&&vt(t,e,r)?(e=0,r=s):(e=e==null?0:N(e),r=r===i?s:N(r)),Dt(t,e,r)):[]}function bp(t,e){return wr(t,e)}function Sp(t,e,r){return Gi(t,e,O(r,2))}function Bp(t,e){var r=t==null?0:t.length;if(r){var s=wr(t,e);if(s<r&&zt(t[s],e))return s}return-1}function Tp(t,e){return wr(t,e,!0)}function Ap(t,e,r){return Gi(t,e,O(r,2),!0)}function Cp(t,e){var r=t==null?0:t.length;if(r){var s=wr(t,e,!0)-1;if(zt(t[s],e))return s}return-1}function Ep(t){return t&&t.length?lu(t):[]}function Pp(t,e){return t&&t.length?lu(t,O(e,2)):[]}function Op(t){var e=t==null?0:t.length;return e?Dt(t,1,e):[]}function Rp(t,e,r){return t&&t.length?(e=r||e===i?1:N(e),Dt(t,0,e<0?0:e)):[]}function Ip(t,e,r){var s=t==null?0:t.length;return s?(e=r||e===i?1:N(e),e=s-e,Dt(t,e<0?0:e,s)):[]}function Lp(t,e){return t&&t.length?xr(t,O(e,3),!1,!0):[]}function kp(t,e){return t&&t.length?xr(t,O(e,3)):[]}var Mp=U(function(t){return Ce(ft(t,1,rt,!0))}),Np=U(function(t){var e=Wt(t);return rt(e)&&(e=i),Ce(ft(t,1,rt,!0),O(e,2))}),Dp=U(function(t){var e=Wt(t);return e=typeof e=="function"?e:i,Ce(ft(t,1,rt,!0),i,e)});function Wp(t){return t&&t.length?Ce(t):[]}function Fp(t,e){return t&&t.length?Ce(t,O(e,2)):[]}function Up(t,e){return e=typeof e=="function"?e:i,t&&t.length?Ce(t,i,e):[]}function os(t){if(!(t&&t.length))return[];var e=0;return t=be(t,function(r){if(rt(r))return e=ut(r.length,e),!0}),Si(e,function(r){return j(t,wi(r))})}function Vu(t,e){if(!(t&&t.length))return[];var r=os(t);return e==null?r:j(r,function(s){return At(e,i,s)})}var Hp=U(function(t,e){return rt(t)?On(t,e):[]}),Gp=U(function(t){return $i(be(t,rt))}),qp=U(function(t){var e=Wt(t);return rt(e)&&(e=i),$i(be(t,rt),O(e,2))}),$p=U(function(t){var e=Wt(t);return e=typeof e=="function"?e:i,$i(be(t,rt),i,e)}),Kp=U(os);function Yp(t,e){return pu(t||[],e||[],Pn)}function Xp(t,e){return pu(t||[],e||[],Ln)}var zp=U(function(t){var e=t.length,r=e>1?t[e-1]:i;return r=typeof r=="function"?(t.pop(),r):i,Vu(t,r)});function Ju(t){var e=l(t);return e.__chain__=!0,e}function Vp(t,e){return e(t),t}function Or(t,e){return e(t)}var Jp=pe(function(t){var e=t.length,r=e?t[0]:0,s=this.__wrapped__,a=function(c){return Ri(c,t)};return e>1||this.__actions__.length||!(s instanceof G)||!de(r)?this.thru(a):(s=s.slice(r,+r+(e?1:0)),s.__actions__.push({func:Or,args:[a],thisArg:i}),new Mt(s,this.__chain__).thru(function(c){return e&&!c.length&&c.push(i),c}))});function Zp(){return Ju(this)}function Qp(){return new Mt(this.value(),this.__chain__)}function jp(){this.__values__===i&&(this.__values__=ca(this.value()));var t=this.__index__>=this.__values__.length,e=t?i:this.__values__[this.__index__++];return{done:t,value:e}}function td(){return this}function ed(t){for(var e,r=this;r instanceof gr;){var s=qu(r);s.__index__=0,s.__values__=i,e?a.__wrapped__=s:e=s;var a=s;r=r.__wrapped__}return a.__wrapped__=t,e}function nd(){var t=this.__wrapped__;if(t instanceof G){var e=t;return this.__actions__.length&&(e=new G(this)),e=e.reverse(),e.__actions__.push({func:Or,args:[ss],thisArg:i}),new Mt(e,this.__chain__)}return this.thru(ss)}function rd(){return fu(this.__wrapped__,this.__actions__)}var id=br(function(t,e,r){X.call(t,r)?++t[r]:he(t,r,1)});function sd(t,e,r){var s=M(t)?To:zh;return r&&vt(t,e,r)&&(e=i),s(t,O(e,3))}function od(t,e){var r=M(t)?be:Vo;return r(t,O(e,3))}var ud=Su($u),ad=Su(Ku);function ld(t,e){return ft(Rr(t,e),1)}function cd(t,e){return ft(Rr(t,e),$n)}function hd(t,e,r){return r=r===i?1:N(r),ft(Rr(t,e),r)}function Zu(t,e){var r=M(t)?Lt:Ae;return r(t,O(e,3))}function Qu(t,e){var r=M(t)?Pc:zo;return r(t,O(e,3))}var fd=br(function(t,e,r){X.call(t,r)?t[r].push(e):he(t,r,[e])});function pd(t,e,r,s){t=St(t)?t:ln(t),r=r&&!s?N(r):0;var a=t.length;return r<0&&(r=ut(a+r,0)),Nr(t)?r<=a&&t.indexOf(e,r)>-1:!!a&&Je(t,e,r)>-1}var dd=U(function(t,e,r){var s=-1,a=typeof e=="function",c=St(t)?v(t.length):[];return Ae(t,function(h){c[++s]=a?At(e,h,r):Rn(h,e,r)}),c}),gd=br(function(t,e,r){he(t,r,e)});function Rr(t,e){var r=M(t)?j:eu;return r(t,O(e,3))}function _d(t,e,r,s){return t==null?[]:(M(e)||(e=e==null?[]:[e]),r=s?i:r,M(r)||(r=r==null?[]:[r]),su(t,e,r))}var vd=br(function(t,e,r){t[r?0:1].push(e)},function(){return[[],[]]});function md(t,e,r){var s=M(t)?mi:Po,a=arguments.length<3;return s(t,O(e,4),r,a,Ae)}function yd(t,e,r){var s=M(t)?Oc:Po,a=arguments.length<3;return s(t,O(e,4),r,a,zo)}function wd(t,e){var r=M(t)?be:Vo;return r(t,kr(O(e,3)))}function xd(t){var e=M(t)?$o:pf;return e(t)}function bd(t,e,r){(r?vt(t,e,r):e===i)?e=1:e=N(e);var s=M(t)?qh:df;return s(t,e)}function Sd(t){var e=M(t)?$h:_f;return e(t)}function Bd(t){if(t==null)return 0;if(St(t))return Nr(t)?Qe(t):t.length;var e=gt(t);return e==$t||e==Kt?t.size:Di(t).length}function Td(t,e,r){var s=M(t)?yi:vf;return r&&vt(t,e,r)&&(e=i),s(t,O(e,3))}var Ad=U(function(t,e){if(t==null)return[];var r=e.length;return r>1&&vt(t,e[0],e[1])?e=[]:r>2&&vt(e[0],e[1],e[2])&&(e=[e[0]]),su(t,ft(e,1),[])}),Ir=sh||function(){return ht.Date.now()};function Cd(t,e){if(typeof e!="function")throw new kt(b);return t=N(t),function(){if(--t<1)return e.apply(this,arguments)}}function ju(t,e,r){return e=r?i:e,e=t&&e==null?t.length:e,fe(t,ue,i,i,i,i,e)}function ta(t,e){var r;if(typeof e!="function")throw new kt(b);return t=N(t),function(){return--t>0&&(r=e.apply(this,arguments)),t<=1&&(e=i),r}}var us=U(function(t,e,r){var s=qt;if(r.length){var a=Be(r,un(us));s|=oe}return fe(t,s,e,r,a)}),ea=U(function(t,e,r){var s=qt|Ke;if(r.length){var a=Be(r,un(ea));s|=oe}return fe(e,s,t,r,a)});function na(t,e,r){e=r?i:e;var s=fe(t,se,i,i,i,i,i,e);return s.placeholder=na.placeholder,s}function ra(t,e,r){e=r?i:e;var s=fe(t,pn,i,i,i,i,i,e);return s.placeholder=ra.placeholder,s}function ia(t,e,r){var s,a,c,h,p,g,w=0,x=!1,S=!1,B=!0;if(typeof t!="function")throw new kt(b);e=Ft(e)||0,et(r)&&(x=!!r.leading,S="maxWait"in r,c=S?ut(Ft(r.maxWait)||0,e):c,B="trailing"in r?!!r.trailing:B);function C(it){var Vt=s,ve=a;return s=a=i,w=it,h=t.apply(ve,Vt),h}function R(it){return w=it,p=Nn(H,e),x?C(it):h}function W(it){var Vt=it-g,ve=it-w,Sa=e-Vt;return S?dt(Sa,c-ve):Sa}function I(it){var Vt=it-g,ve=it-w;return g===i||Vt>=e||Vt<0||S&&ve>=c}function H(){var it=Ir();if(I(it))return q(it);p=Nn(H,W(it))}function q(it){return p=i,B&&s?C(it):(s=a=i,h)}function Ot(){p!==i&&du(p),w=0,s=g=a=p=i}function mt(){return p===i?h:q(Ir())}function Rt(){var it=Ir(),Vt=I(it);if(s=arguments,a=this,g=it,Vt){if(p===i)return R(g);if(S)return du(p),p=Nn(H,e),C(g)}return p===i&&(p=Nn(H,e)),h}return Rt.cancel=Ot,Rt.flush=mt,Rt}var Ed=U(function(t,e){return Xo(t,1,e)}),Pd=U(function(t,e,r){return Xo(t,Ft(e)||0,r)});function Od(t){return fe(t,Qr)}function Lr(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new kt(b);var r=function(){var s=arguments,a=e?e.apply(this,s):s[0],c=r.cache;if(c.has(a))return c.get(a);var h=t.apply(this,s);return r.cache=c.set(a,h)||c,h};return r.cache=new(Lr.Cache||ce),r}Lr.Cache=ce;function kr(t){if(typeof t!="function")throw new kt(b);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Rd(t){return ta(2,t)}var Id=mf(function(t,e){e=e.length==1&&M(e[0])?j(e[0],Ct(O())):j(ft(e,1),Ct(O()));var r=e.length;return U(function(s){for(var a=-1,c=dt(s.length,r);++a<c;)s[a]=e[a].call(this,s[a]);return At(t,this,s)})}),as=U(function(t,e){var r=Be(e,un(as));return fe(t,oe,i,e,r)}),sa=U(function(t,e){var r=Be(e,un(sa));return fe(t,dn,i,e,r)}),Ld=pe(function(t,e){return fe(t,gn,i,i,i,e)});function kd(t,e){if(typeof t!="function")throw new kt(b);return e=e===i?e:N(e),U(t,e)}function Md(t,e){if(typeof t!="function")throw new kt(b);return e=e==null?0:ut(N(e),0),U(function(r){var s=r[e],a=Pe(r,0,e);return s&&Se(a,s),At(t,this,a)})}function Nd(t,e,r){var s=!0,a=!0;if(typeof t!="function")throw new kt(b);return et(r)&&(s="leading"in r?!!r.leading:s,a="trailing"in r?!!r.trailing:a),ia(t,e,{leading:s,maxWait:e,trailing:a})}function Dd(t){return ju(t,1)}function Wd(t,e){return as(Yi(e),t)}function Fd(){if(!arguments.length)return[];var t=arguments[0];return M(t)?t:[t]}function Ud(t){return Nt(t,we)}function Hd(t,e){return e=typeof e=="function"?e:i,Nt(t,we,e)}function Gd(t){return Nt(t,F|we)}function qd(t,e){return e=typeof e=="function"?e:i,Nt(t,F|we,e)}function $d(t,e){return e==null||Yo(t,e,at(e))}function zt(t,e){return t===e||t!==t&&e!==e}var Kd=Ar(ki),Yd=Ar(function(t,e){return t>=e}),qe=Qo(function(){return arguments}())?Qo:function(t){return nt(t)&&X.call(t,"callee")&&!Wo.call(t,"callee")},M=v.isArray,Xd=yo?Ct(yo):tf;function St(t){return t!=null&&Mr(t.length)&&!ge(t)}function rt(t){return nt(t)&&St(t)}function zd(t){return t===!0||t===!1||nt(t)&&_t(t)==_n}var Oe=uh||ys,Vd=wo?Ct(wo):ef;function Jd(t){return nt(t)&&t.nodeType===1&&!Dn(t)}function Zd(t){if(t==null)return!0;if(St(t)&&(M(t)||typeof t=="string"||typeof t.splice=="function"||Oe(t)||an(t)||qe(t)))return!t.length;var e=gt(t);if(e==$t||e==Kt)return!t.size;if(Mn(t))return!Di(t).length;for(var r in t)if(X.call(t,r))return!1;return!0}function Qd(t,e){return In(t,e)}function jd(t,e,r){r=typeof r=="function"?r:i;var s=r?r(t,e):i;return s===i?In(t,e,i,r):!!s}function ls(t){if(!nt(t))return!1;var e=_t(t);return e==Xn||e==xl||typeof t.message=="string"&&typeof t.name=="string"&&!Dn(t)}function tg(t){return typeof t=="number"&&Uo(t)}function ge(t){if(!et(t))return!1;var e=_t(t);return e==zn||e==Ys||e==wl||e==Sl}function oa(t){return typeof t=="number"&&t==N(t)}function Mr(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Ye}function et(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function nt(t){return t!=null&&typeof t=="object"}var ua=xo?Ct(xo):rf;function eg(t,e){return t===e||Ni(t,e,ji(e))}function ng(t,e,r){return r=typeof r=="function"?r:i,Ni(t,e,ji(e),r)}function rg(t){return aa(t)&&t!=+t}function ig(t){if(Hf(t))throw new k(_);return jo(t)}function sg(t){return t===null}function og(t){return t==null}function aa(t){return typeof t=="number"||nt(t)&&_t(t)==mn}function Dn(t){if(!nt(t)||_t(t)!=ae)return!1;var e=ar(t);if(e===null)return!0;var r=X.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&ir.call(r)==eh}var cs=bo?Ct(bo):sf;function ug(t){return oa(t)&&t>=-9007199254740991&&t<=Ye}var la=So?Ct(So):of;function Nr(t){return typeof t=="string"||!M(t)&&nt(t)&&_t(t)==wn}function Pt(t){return typeof t=="symbol"||nt(t)&&_t(t)==Vn}var an=Bo?Ct(Bo):uf;function ag(t){return t===i}function lg(t){return nt(t)&&gt(t)==xn}function cg(t){return nt(t)&&_t(t)==Tl}var hg=Ar(Wi),fg=Ar(function(t,e){return t<=e});function ca(t){if(!t)return[];if(St(t))return Nr(t)?Yt(t):bt(t);if(Bn&&t[Bn])return qc(t[Bn]());var e=gt(t),r=e==$t?Ti:e==Kt?er:ln;return r(t)}function _e(t){if(!t)return t===0?t:0;if(t=Ft(t),t===$n||t===-1/0){var e=t<0?-1:1;return e*_l}return t===t?t:0}function N(t){var e=_e(t),r=e%1;return e===e?r?e-r:e:0}function ha(t){return t?Fe(N(t),0,Qt):0}function Ft(t){if(typeof t=="number")return t;if(Pt(t))return Kn;if(et(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=et(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Oo(t);var r=Yl.test(t);return r||zl.test(t)?Ac(t.slice(2),r?2:8):Kl.test(t)?Kn:+t}function fa(t){return te(t,Bt(t))}function pg(t){return t?Fe(N(t),-9007199254740991,Ye):t===0?t:0}function Y(t){return t==null?"":Et(t)}var dg=sn(function(t,e){if(Mn(e)||St(e)){te(e,at(e),t);return}for(var r in e)X.call(e,r)&&Pn(t,r,e[r])}),pa=sn(function(t,e){te(e,Bt(e),t)}),Dr=sn(function(t,e,r,s){te(e,Bt(e),t,s)}),gg=sn(function(t,e,r,s){te(e,at(e),t,s)}),_g=pe(Ri);function vg(t,e){var r=rn(t);return e==null?r:Ko(r,e)}var mg=U(function(t,e){t=J(t);var r=-1,s=e.length,a=s>2?e[2]:i;for(a&&vt(e[0],e[1],a)&&(s=1);++r<s;)for(var c=e[r],h=Bt(c),p=-1,g=h.length;++p<g;){var w=h[p],x=t[w];(x===i||zt(x,tn[w])&&!X.call(t,w))&&(t[w]=c[w])}return t}),yg=U(function(t){return t.push(i,Ou),At(da,i,t)});function wg(t,e){return Ao(t,O(e,3),jt)}function xg(t,e){return Ao(t,O(e,3),Li)}function bg(t,e){return t==null?t:Ii(t,O(e,3),Bt)}function Sg(t,e){return t==null?t:Jo(t,O(e,3),Bt)}function Bg(t,e){return t&&jt(t,O(e,3))}function Tg(t,e){return t&&Li(t,O(e,3))}function Ag(t){return t==null?[]:mr(t,at(t))}function Cg(t){return t==null?[]:mr(t,Bt(t))}function hs(t,e,r){var s=t==null?i:Ue(t,e);return s===i?r:s}function Eg(t,e){return t!=null&&Lu(t,e,Jh)}function fs(t,e){return t!=null&&Lu(t,e,Zh)}var Pg=Tu(function(t,e,r){e!=null&&typeof e.toString!="function"&&(e=sr.call(e)),t[e]=r},ds(Tt)),Og=Tu(function(t,e,r){e!=null&&typeof e.toString!="function"&&(e=sr.call(e)),X.call(t,e)?t[e].push(r):t[e]=[r]},O),Rg=U(Rn);function at(t){return St(t)?qo(t):Di(t)}function Bt(t){return St(t)?qo(t,!0):af(t)}function Ig(t,e){var r={};return e=O(e,3),jt(t,function(s,a,c){he(r,e(s,a,c),s)}),r}function Lg(t,e){var r={};return e=O(e,3),jt(t,function(s,a,c){he(r,a,e(s,a,c))}),r}var kg=sn(function(t,e,r){yr(t,e,r)}),da=sn(function(t,e,r,s){yr(t,e,r,s)}),Mg=pe(function(t,e){var r={};if(t==null)return r;var s=!1;e=j(e,function(c){return c=Ee(c,t),s||(s=c.length>1),c}),te(t,Zi(t),r),s&&(r=Nt(r,F|Zt|we,Pf));for(var a=e.length;a--;)qi(r,e[a]);return r});function Ng(t,e){return ga(t,kr(O(e)))}var Dg=pe(function(t,e){return t==null?{}:cf(t,e)});function ga(t,e){if(t==null)return{};var r=j(Zi(t),function(s){return[s]});return e=O(e),ou(t,r,function(s,a){return e(s,a[0])})}function Wg(t,e,r){e=Ee(e,t);var s=-1,a=e.length;for(a||(a=1,t=i);++s<a;){var c=t==null?i:t[ee(e[s])];c===i&&(s=a,c=r),t=ge(c)?c.call(t):c}return t}function Fg(t,e,r){return t==null?t:Ln(t,e,r)}function Ug(t,e,r,s){return s=typeof s=="function"?s:i,t==null?t:Ln(t,e,r,s)}var _a=Eu(at),va=Eu(Bt);function Hg(t,e,r){var s=M(t),a=s||Oe(t)||an(t);if(e=O(e,4),r==null){var c=t&&t.constructor;a?r=s?new c:[]:et(t)?r=ge(c)?rn(ar(t)):{}:r={}}return(a?Lt:jt)(t,function(h,p,g){return e(r,h,p,g)}),r}function Gg(t,e){return t==null?!0:qi(t,e)}function qg(t,e,r){return t==null?t:hu(t,e,Yi(r))}function $g(t,e,r,s){return s=typeof s=="function"?s:i,t==null?t:hu(t,e,Yi(r),s)}function ln(t){return t==null?[]:Bi(t,at(t))}function Kg(t){return t==null?[]:Bi(t,Bt(t))}function Yg(t,e,r){return r===i&&(r=e,e=i),r!==i&&(r=Ft(r),r=r===r?r:0),e!==i&&(e=Ft(e),e=e===e?e:0),Fe(Ft(t),e,r)}function Xg(t,e,r){return e=_e(e),r===i?(r=e,e=0):r=_e(r),t=Ft(t),Qh(t,e,r)}function zg(t,e,r){if(r&&typeof r!="boolean"&&vt(t,e,r)&&(e=r=i),r===i&&(typeof e=="boolean"?(r=e,e=i):typeof t=="boolean"&&(r=t,t=i)),t===i&&e===i?(t=0,e=1):(t=_e(t),e===i?(e=t,t=0):e=_e(e)),t>e){var s=t;t=e,e=s}if(r||t%1||e%1){var a=Ho();return dt(t+a*(e-t+Tc("1e-"+((a+"").length-1))),e)}return Ui(t,e)}var Vg=on(function(t,e,r){return e=e.toLowerCase(),t+(r?ma(e):e)});function ma(t){return ps(Y(t).toLowerCase())}function ya(t){return t=Y(t),t&&t.replace(Jl,Wc).replace(gc,"")}function Jg(t,e,r){t=Y(t),e=Et(e);var s=t.length;r=r===i?s:Fe(N(r),0,s);var a=r;return r-=e.length,r>=0&&t.slice(r,a)==e}function Zg(t){return t=Y(t),t&&Ol.test(t)?t.replace(Vs,Fc):t}function Qg(t){return t=Y(t),t&&Nl.test(t)?t.replace(ai,"\\$&"):t}var jg=on(function(t,e,r){return t+(r?"-":"")+e.toLowerCase()}),t_=on(function(t,e,r){return t+(r?" ":"")+e.toLowerCase()}),e_=bu("toLowerCase");function n_(t,e,r){t=Y(t),e=N(e);var s=e?Qe(t):0;if(!e||s>=e)return t;var a=(e-s)/2;return Tr(fr(a),r)+t+Tr(hr(a),r)}function r_(t,e,r){t=Y(t),e=N(e);var s=e?Qe(t):0;return e&&s<e?t+Tr(e-s,r):t}function i_(t,e,r){t=Y(t),e=N(e);var s=e?Qe(t):0;return e&&s<e?Tr(e-s,r)+t:t}function s_(t,e,r){return r||e==null?e=0:e&&(e=+e),hh(Y(t).replace(li,""),e||0)}function o_(t,e,r){return(r?vt(t,e,r):e===i)?e=1:e=N(e),Hi(Y(t),e)}function u_(){var t=arguments,e=Y(t[0]);return t.length<3?e:e.replace(t[1],t[2])}var a_=on(function(t,e,r){return t+(r?"_":"")+e.toLowerCase()});function l_(t,e,r){return r&&typeof r!="number"&&vt(t,e,r)&&(e=r=i),r=r===i?Qt:r>>>0,r?(t=Y(t),t&&(typeof e=="string"||e!=null&&!cs(e))&&(e=Et(e),!e&&Ze(t))?Pe(Yt(t),0,r):t.split(e,r)):[]}var c_=on(function(t,e,r){return t+(r?" ":"")+ps(e)});function h_(t,e,r){return t=Y(t),r=r==null?0:Fe(N(r),0,t.length),e=Et(e),t.slice(r,r+e.length)==e}function f_(t,e,r){var s=l.templateSettings;r&&vt(t,e,r)&&(e=i),t=Y(t),e=Dr({},e,s,Pu);var a=Dr({},e.imports,s.imports,Pu),c=at(a),h=Bi(a,c),p,g,w=0,x=e.interpolate||Jn,S="__p += '",B=Ai((e.escape||Jn).source+"|"+x.source+"|"+(x===Js?$l:Jn).source+"|"+(e.evaluate||Jn).source+"|$","g"),C="//# sourceURL="+(X.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++wc+"]")+`
`;t.replace(B,function(I,H,q,Ot,mt,Rt){return q||(q=Ot),S+=t.slice(w,Rt).replace(Zl,Uc),H&&(p=!0,S+=`' +
__e(`+H+`) +
'`),mt&&(g=!0,S+=`';
`+mt+`;
__p += '`),q&&(S+=`' +
((__t = (`+q+`)) == null ? '' : __t) +
'`),w=Rt+I.length,I}),S+=`';
`;var R=X.call(e,"variable")&&e.variable;if(!R)S=`with (obj) {
`+S+`
}
`;else if(Gl.test(R))throw new k(P);S=(g?S.replace(Al,""):S).replace(Cl,"$1").replace(El,"$1;"),S="function("+(R||"obj")+`) {
`+(R?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(p?", __e = _.escape":"")+(g?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+S+`return __p
}`;var W=xa(function(){return K(c,C+"return "+S).apply(i,h)});if(W.source=S,ls(W))throw W;return W}function p_(t){return Y(t).toLowerCase()}function d_(t){return Y(t).toUpperCase()}function g_(t,e,r){if(t=Y(t),t&&(r||e===i))return Oo(t);if(!t||!(e=Et(e)))return t;var s=Yt(t),a=Yt(e),c=Ro(s,a),h=Io(s,a)+1;return Pe(s,c,h).join("")}function __(t,e,r){if(t=Y(t),t&&(r||e===i))return t.slice(0,ko(t)+1);if(!t||!(e=Et(e)))return t;var s=Yt(t),a=Io(s,Yt(e))+1;return Pe(s,0,a).join("")}function v_(t,e,r){if(t=Y(t),t&&(r||e===i))return t.replace(li,"");if(!t||!(e=Et(e)))return t;var s=Yt(t),a=Ro(s,Yt(e));return Pe(s,a).join("")}function m_(t,e){var r=cl,s=hl;if(et(e)){var a="separator"in e?e.separator:a;r="length"in e?N(e.length):r,s="omission"in e?Et(e.omission):s}t=Y(t);var c=t.length;if(Ze(t)){var h=Yt(t);c=h.length}if(r>=c)return t;var p=r-Qe(s);if(p<1)return s;var g=h?Pe(h,0,p).join(""):t.slice(0,p);if(a===i)return g+s;if(h&&(p+=g.length-p),cs(a)){if(t.slice(p).search(a)){var w,x=g;for(a.global||(a=Ai(a.source,Y(Zs.exec(a))+"g")),a.lastIndex=0;w=a.exec(x);)var S=w.index;g=g.slice(0,S===i?p:S)}}else if(t.indexOf(Et(a),p)!=p){var B=g.lastIndexOf(a);B>-1&&(g=g.slice(0,B))}return g+s}function y_(t){return t=Y(t),t&&Pl.test(t)?t.replace(zs,Xc):t}var w_=on(function(t,e,r){return t+(r?" ":"")+e.toUpperCase()}),ps=bu("toUpperCase");function wa(t,e,r){return t=Y(t),e=r?i:e,e===i?Gc(t)?Jc(t):Lc(t):t.match(e)||[]}var xa=U(function(t,e){try{return At(t,i,e)}catch(r){return ls(r)?r:new k(r)}}),x_=pe(function(t,e){return Lt(e,function(r){r=ee(r),he(t,r,us(t[r],t))}),t});function b_(t){var e=t==null?0:t.length,r=O();return t=e?j(t,function(s){if(typeof s[1]!="function")throw new kt(b);return[r(s[0]),s[1]]}):[],U(function(s){for(var a=-1;++a<e;){var c=t[a];if(At(c[0],this,s))return At(c[1],this,s)}})}function S_(t){return Xh(Nt(t,F))}function ds(t){return function(){return t}}function B_(t,e){return t==null||t!==t?e:t}var T_=Bu(),A_=Bu(!0);function Tt(t){return t}function gs(t){return tu(typeof t=="function"?t:Nt(t,F))}function C_(t){return nu(Nt(t,F))}function E_(t,e){return ru(t,Nt(e,F))}var P_=U(function(t,e){return function(r){return Rn(r,t,e)}}),O_=U(function(t,e){return function(r){return Rn(t,r,e)}});function _s(t,e,r){var s=at(e),a=mr(e,s);r==null&&!(et(e)&&(a.length||!s.length))&&(r=e,e=t,t=this,a=mr(e,at(e)));var c=!(et(r)&&"chain"in r)||!!r.chain,h=ge(t);return Lt(a,function(p){var g=e[p];t[p]=g,h&&(t.prototype[p]=function(){var w=this.__chain__;if(c||w){var x=t(this.__wrapped__),S=x.__actions__=bt(this.__actions__);return S.push({func:g,args:arguments,thisArg:t}),x.__chain__=w,x}return g.apply(t,Se([this.value()],arguments))})}),t}function R_(){return ht._===this&&(ht._=nh),this}function vs(){}function I_(t){return t=N(t),U(function(e){return iu(e,t)})}var L_=zi(j),k_=zi(To),M_=zi(yi);function ba(t){return es(t)?wi(ee(t)):hf(t)}function N_(t){return function(e){return t==null?i:Ue(t,e)}}var D_=Au(),W_=Au(!0);function ms(){return[]}function ys(){return!1}function F_(){return{}}function U_(){return""}function H_(){return!0}function G_(t,e){if(t=N(t),t<1||t>Ye)return[];var r=Qt,s=dt(t,Qt);e=O(e),t-=Qt;for(var a=Si(s,e);++r<t;)e(r);return a}function q_(t){return M(t)?j(t,ee):Pt(t)?[t]:bt(Gu(Y(t)))}function $_(t){var e=++th;return Y(t)+e}var K_=Br(function(t,e){return t+e},0),Y_=Vi("ceil"),X_=Br(function(t,e){return t/e},1),z_=Vi("floor");function V_(t){return t&&t.length?vr(t,Tt,ki):i}function J_(t,e){return t&&t.length?vr(t,O(e,2),ki):i}function Z_(t){return Eo(t,Tt)}function Q_(t,e){return Eo(t,O(e,2))}function j_(t){return t&&t.length?vr(t,Tt,Wi):i}function tv(t,e){return t&&t.length?vr(t,O(e,2),Wi):i}var ev=Br(function(t,e){return t*e},1),nv=Vi("round"),rv=Br(function(t,e){return t-e},0);function iv(t){return t&&t.length?bi(t,Tt):0}function sv(t,e){return t&&t.length?bi(t,O(e,2)):0}return l.after=Cd,l.ary=ju,l.assign=dg,l.assignIn=pa,l.assignInWith=Dr,l.assignWith=gg,l.at=_g,l.before=ta,l.bind=us,l.bindAll=x_,l.bindKey=ea,l.castArray=Fd,l.chain=Ju,l.chunk=zf,l.compact=Vf,l.concat=Jf,l.cond=b_,l.conforms=S_,l.constant=ds,l.countBy=id,l.create=vg,l.curry=na,l.curryRight=ra,l.debounce=ia,l.defaults=mg,l.defaultsDeep=yg,l.defer=Ed,l.delay=Pd,l.difference=Zf,l.differenceBy=Qf,l.differenceWith=jf,l.drop=tp,l.dropRight=ep,l.dropRightWhile=np,l.dropWhile=rp,l.fill=ip,l.filter=od,l.flatMap=ld,l.flatMapDeep=cd,l.flatMapDepth=hd,l.flatten=Yu,l.flattenDeep=sp,l.flattenDepth=op,l.flip=Od,l.flow=T_,l.flowRight=A_,l.fromPairs=up,l.functions=Ag,l.functionsIn=Cg,l.groupBy=fd,l.initial=lp,l.intersection=cp,l.intersectionBy=hp,l.intersectionWith=fp,l.invert=Pg,l.invertBy=Og,l.invokeMap=dd,l.iteratee=gs,l.keyBy=gd,l.keys=at,l.keysIn=Bt,l.map=Rr,l.mapKeys=Ig,l.mapValues=Lg,l.matches=C_,l.matchesProperty=E_,l.memoize=Lr,l.merge=kg,l.mergeWith=da,l.method=P_,l.methodOf=O_,l.mixin=_s,l.negate=kr,l.nthArg=I_,l.omit=Mg,l.omitBy=Ng,l.once=Rd,l.orderBy=_d,l.over=L_,l.overArgs=Id,l.overEvery=k_,l.overSome=M_,l.partial=as,l.partialRight=sa,l.partition=vd,l.pick=Dg,l.pickBy=ga,l.property=ba,l.propertyOf=N_,l.pull=_p,l.pullAll=zu,l.pullAllBy=vp,l.pullAllWith=mp,l.pullAt=yp,l.range=D_,l.rangeRight=W_,l.rearg=Ld,l.reject=wd,l.remove=wp,l.rest=kd,l.reverse=ss,l.sampleSize=bd,l.set=Fg,l.setWith=Ug,l.shuffle=Sd,l.slice=xp,l.sortBy=Ad,l.sortedUniq=Ep,l.sortedUniqBy=Pp,l.split=l_,l.spread=Md,l.tail=Op,l.take=Rp,l.takeRight=Ip,l.takeRightWhile=Lp,l.takeWhile=kp,l.tap=Vp,l.throttle=Nd,l.thru=Or,l.toArray=ca,l.toPairs=_a,l.toPairsIn=va,l.toPath=q_,l.toPlainObject=fa,l.transform=Hg,l.unary=Dd,l.union=Mp,l.unionBy=Np,l.unionWith=Dp,l.uniq=Wp,l.uniqBy=Fp,l.uniqWith=Up,l.unset=Gg,l.unzip=os,l.unzipWith=Vu,l.update=qg,l.updateWith=$g,l.values=ln,l.valuesIn=Kg,l.without=Hp,l.words=wa,l.wrap=Wd,l.xor=Gp,l.xorBy=qp,l.xorWith=$p,l.zip=Kp,l.zipObject=Yp,l.zipObjectDeep=Xp,l.zipWith=zp,l.entries=_a,l.entriesIn=va,l.extend=pa,l.extendWith=Dr,_s(l,l),l.add=K_,l.attempt=xa,l.camelCase=Vg,l.capitalize=ma,l.ceil=Y_,l.clamp=Yg,l.clone=Ud,l.cloneDeep=Gd,l.cloneDeepWith=qd,l.cloneWith=Hd,l.conformsTo=$d,l.deburr=ya,l.defaultTo=B_,l.divide=X_,l.endsWith=Jg,l.eq=zt,l.escape=Zg,l.escapeRegExp=Qg,l.every=sd,l.find=ud,l.findIndex=$u,l.findKey=wg,l.findLast=ad,l.findLastIndex=Ku,l.findLastKey=xg,l.floor=z_,l.forEach=Zu,l.forEachRight=Qu,l.forIn=bg,l.forInRight=Sg,l.forOwn=Bg,l.forOwnRight=Tg,l.get=hs,l.gt=Kd,l.gte=Yd,l.has=Eg,l.hasIn=fs,l.head=Xu,l.identity=Tt,l.includes=pd,l.indexOf=ap,l.inRange=Xg,l.invoke=Rg,l.isArguments=qe,l.isArray=M,l.isArrayBuffer=Xd,l.isArrayLike=St,l.isArrayLikeObject=rt,l.isBoolean=zd,l.isBuffer=Oe,l.isDate=Vd,l.isElement=Jd,l.isEmpty=Zd,l.isEqual=Qd,l.isEqualWith=jd,l.isError=ls,l.isFinite=tg,l.isFunction=ge,l.isInteger=oa,l.isLength=Mr,l.isMap=ua,l.isMatch=eg,l.isMatchWith=ng,l.isNaN=rg,l.isNative=ig,l.isNil=og,l.isNull=sg,l.isNumber=aa,l.isObject=et,l.isObjectLike=nt,l.isPlainObject=Dn,l.isRegExp=cs,l.isSafeInteger=ug,l.isSet=la,l.isString=Nr,l.isSymbol=Pt,l.isTypedArray=an,l.isUndefined=ag,l.isWeakMap=lg,l.isWeakSet=cg,l.join=pp,l.kebabCase=jg,l.last=Wt,l.lastIndexOf=dp,l.lowerCase=t_,l.lowerFirst=e_,l.lt=hg,l.lte=fg,l.max=V_,l.maxBy=J_,l.mean=Z_,l.meanBy=Q_,l.min=j_,l.minBy=tv,l.stubArray=ms,l.stubFalse=ys,l.stubObject=F_,l.stubString=U_,l.stubTrue=H_,l.multiply=ev,l.nth=gp,l.noConflict=R_,l.noop=vs,l.now=Ir,l.pad=n_,l.padEnd=r_,l.padStart=i_,l.parseInt=s_,l.random=zg,l.reduce=md,l.reduceRight=yd,l.repeat=o_,l.replace=u_,l.result=Wg,l.round=nv,l.runInContext=d,l.sample=xd,l.size=Bd,l.snakeCase=a_,l.some=Td,l.sortedIndex=bp,l.sortedIndexBy=Sp,l.sortedIndexOf=Bp,l.sortedLastIndex=Tp,l.sortedLastIndexBy=Ap,l.sortedLastIndexOf=Cp,l.startCase=c_,l.startsWith=h_,l.subtract=rv,l.sum=iv,l.sumBy=sv,l.template=f_,l.times=G_,l.toFinite=_e,l.toInteger=N,l.toLength=ha,l.toLower=p_,l.toNumber=Ft,l.toSafeInteger=pg,l.toString=Y,l.toUpper=d_,l.trim=g_,l.trimEnd=__,l.trimStart=v_,l.truncate=m_,l.unescape=y_,l.uniqueId=$_,l.upperCase=w_,l.upperFirst=ps,l.each=Zu,l.eachRight=Qu,l.first=Xu,_s(l,function(){var t={};return jt(l,function(e,r){X.call(l.prototype,r)||(t[r]=e)}),t}(),{chain:!1}),l.VERSION=o,Lt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){l[t].placeholder=l}),Lt(["drop","take"],function(t,e){G.prototype[t]=function(r){r=r===i?1:ut(N(r),0);var s=this.__filtered__&&!e?new G(this):this.clone();return s.__filtered__?s.__takeCount__=dt(r,s.__takeCount__):s.__views__.push({size:dt(r,Qt),type:t+(s.__dir__<0?"Right":"")}),s},G.prototype[t+"Right"]=function(r){return this.reverse()[t](r).reverse()}}),Lt(["filter","map","takeWhile"],function(t,e){var r=e+1,s=r==Ks||r==gl;G.prototype[t]=function(a){var c=this.clone();return c.__iteratees__.push({iteratee:O(a,3),type:r}),c.__filtered__=c.__filtered__||s,c}}),Lt(["head","last"],function(t,e){var r="take"+(e?"Right":"");G.prototype[t]=function(){return this[r](1).value()[0]}}),Lt(["initial","tail"],function(t,e){var r="drop"+(e?"":"Right");G.prototype[t]=function(){return this.__filtered__?new G(this):this[r](1)}}),G.prototype.compact=function(){return this.filter(Tt)},G.prototype.find=function(t){return this.filter(t).head()},G.prototype.findLast=function(t){return this.reverse().find(t)},G.prototype.invokeMap=U(function(t,e){return typeof t=="function"?new G(this):this.map(function(r){return Rn(r,t,e)})}),G.prototype.reject=function(t){return this.filter(kr(O(t)))},G.prototype.slice=function(t,e){t=N(t);var r=this;return r.__filtered__&&(t>0||e<0)?new G(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),e!==i&&(e=N(e),r=e<0?r.dropRight(-e):r.take(e-t)),r)},G.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},G.prototype.toArray=function(){return this.take(Qt)},jt(G.prototype,function(t,e){var r=/^(?:filter|find|map|reject)|While$/.test(e),s=/^(?:head|last)$/.test(e),a=l[s?"take"+(e=="last"?"Right":""):e],c=s||/^find/.test(e);a&&(l.prototype[e]=function(){var h=this.__wrapped__,p=s?[1]:arguments,g=h instanceof G,w=p[0],x=g||M(h),S=function(H){var q=a.apply(l,Se([H],p));return s&&B?q[0]:q};x&&r&&typeof w=="function"&&w.length!=1&&(g=x=!1);var B=this.__chain__,C=!!this.__actions__.length,R=c&&!B,W=g&&!C;if(!c&&x){h=W?h:new G(this);var I=t.apply(h,p);return I.__actions__.push({func:Or,args:[S],thisArg:i}),new Mt(I,B)}return R&&W?t.apply(this,p):(I=this.thru(S),R?s?I.value()[0]:I.value():I)})}),Lt(["pop","push","shift","sort","splice","unshift"],function(t){var e=nr[t],r=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",s=/^(?:pop|shift)$/.test(t);l.prototype[t]=function(){var a=arguments;if(s&&!this.__chain__){var c=this.value();return e.apply(M(c)?c:[],a)}return this[r](function(h){return e.apply(M(h)?h:[],a)})}}),jt(G.prototype,function(t,e){var r=l[e];if(r){var s=r.name+"";X.call(nn,s)||(nn[s]=[]),nn[s].push({name:e,func:r})}}),nn[Sr(i,Ke).name]=[{name:"wrapper",func:i}],G.prototype.clone=mh,G.prototype.reverse=yh,G.prototype.value=wh,l.prototype.at=Jp,l.prototype.chain=Zp,l.prototype.commit=Qp,l.prototype.next=jp,l.prototype.plant=ed,l.prototype.reverse=nd,l.prototype.toJSON=l.prototype.valueOf=l.prototype.value=rd,l.prototype.first=l.prototype.head,Bn&&(l.prototype[Bn]=td),l},je=Zc();Me?((Me.exports=je)._=je,gi._=je):ht._=je}).call(cv)}(Un,Un.exports)),Un.exports}var fv=hv();const pv=lv(fv);class $a{constructor(){A(this,"down",!1);A(this,"pressed",!1)}}const ie=Object.create(null);ie.open="0";ie.close="1";ie.ping="2";ie.pong="3";ie.message="4";ie.upgrade="5";ie.noop="6";const qr=Object.create(null);Object.keys(ie).forEach(u=>{qr[ie[u]]=u});const Es={type:"error",data:"parser error"},Ka=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Ya=typeof ArrayBuffer=="function",Xa=u=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(u):u&&u.buffer instanceof ArrayBuffer,Ms=({type:u,data:n},i,o)=>Ka&&n instanceof Blob?i?o(n):Ta(n,o):Ya&&(n instanceof ArrayBuffer||Xa(n))?i?o(n):Ta(new Blob([n]),o):o(ie[u]+(n||"")),Ta=(u,n)=>{const i=new FileReader;return i.onload=function(){const o=i.result.split(",")[1];n("b"+(o||""))},i.readAsDataURL(u)};function Aa(u){return u instanceof Uint8Array?u:u instanceof ArrayBuffer?new Uint8Array(u):new Uint8Array(u.buffer,u.byteOffset,u.byteLength)}let xs;function dv(u,n){if(Ka&&u.data instanceof Blob)return u.data.arrayBuffer().then(Aa).then(n);if(Ya&&(u.data instanceof ArrayBuffer||Xa(u.data)))return n(Aa(u.data));Ms(u,!1,i=>{xs||(xs=new TextEncoder),n(xs.encode(i))})}const Ca="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Hn=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let u=0;u<Ca.length;u++)Hn[Ca.charCodeAt(u)]=u;const gv=u=>{let n=u.length*.75,i=u.length,o,f=0,_,b,P,L;u[u.length-1]==="="&&(n--,u[u.length-2]==="="&&n--);const ct=new ArrayBuffer(n),tt=new Uint8Array(ct);for(o=0;o<i;o+=4)_=Hn[u.charCodeAt(o)],b=Hn[u.charCodeAt(o+1)],P=Hn[u.charCodeAt(o+2)],L=Hn[u.charCodeAt(o+3)],tt[f++]=_<<2|b>>4,tt[f++]=(b&15)<<4|P>>2,tt[f++]=(P&3)<<6|L&63;return ct},_v=typeof ArrayBuffer=="function",Ns=(u,n)=>{if(typeof u!="string")return{type:"message",data:za(u,n)};const i=u.charAt(0);return i==="b"?{type:"message",data:vv(u.substring(1),n)}:qr[i]?u.length>1?{type:qr[i],data:u.substring(1)}:{type:qr[i]}:Es},vv=(u,n)=>{if(_v){const i=gv(u);return za(i,n)}else return{base64:!0,data:u}},za=(u,n)=>{switch(n){case"blob":return u instanceof Blob?u:new Blob([u]);case"arraybuffer":default:return u instanceof ArrayBuffer?u:u.buffer}},Va="",mv=(u,n)=>{const i=u.length,o=new Array(i);let f=0;u.forEach((_,b)=>{Ms(_,!1,P=>{o[b]=P,++f===i&&n(o.join(Va))})})},yv=(u,n)=>{const i=u.split(Va),o=[];for(let f=0;f<i.length;f++){const _=Ns(i[f],n);if(o.push(_),_.type==="error")break}return o};function wv(){return new TransformStream({transform(u,n){dv(u,i=>{const o=i.length;let f;if(o<126)f=new Uint8Array(1),new DataView(f.buffer).setUint8(0,o);else if(o<65536){f=new Uint8Array(3);const _=new DataView(f.buffer);_.setUint8(0,126),_.setUint16(1,o)}else{f=new Uint8Array(9);const _=new DataView(f.buffer);_.setUint8(0,127),_.setBigUint64(1,BigInt(o))}u.data&&typeof u.data!="string"&&(f[0]|=128),n.enqueue(f),n.enqueue(i)})}})}let bs;function Fr(u){return u.reduce((n,i)=>n+i.length,0)}function Ur(u,n){if(u[0].length===n)return u.shift();const i=new Uint8Array(n);let o=0;for(let f=0;f<n;f++)i[f]=u[0][o++],o===u[0].length&&(u.shift(),o=0);return u.length&&o<u[0].length&&(u[0]=u[0].slice(o)),i}function xv(u,n){bs||(bs=new TextDecoder);const i=[];let o=0,f=-1,_=!1;return new TransformStream({transform(b,P){for(i.push(b);;){if(o===0){if(Fr(i)<1)break;const L=Ur(i,1);_=(L[0]&128)===128,f=L[0]&127,f<126?o=3:f===126?o=1:o=2}else if(o===1){if(Fr(i)<2)break;const L=Ur(i,2);f=new DataView(L.buffer,L.byteOffset,L.length).getUint16(0),o=3}else if(o===2){if(Fr(i)<8)break;const L=Ur(i,8),ct=new DataView(L.buffer,L.byteOffset,L.length),tt=ct.getUint32(0);if(tt>Math.pow(2,21)-1){P.enqueue(Es);break}f=tt*Math.pow(2,32)+ct.getUint32(4),o=3}else{if(Fr(i)<f)break;const L=Ur(i,f);P.enqueue(Ns(_?L:bs.decode(L),n)),o=0}if(f===0||f>u){P.enqueue(Es);break}}}})}const Ja=4;function st(u){if(u)return bv(u)}function bv(u){for(var n in st.prototype)u[n]=st.prototype[n];return u}st.prototype.on=st.prototype.addEventListener=function(u,n){return this._callbacks=this._callbacks||{},(this._callbacks["$"+u]=this._callbacks["$"+u]||[]).push(n),this};st.prototype.once=function(u,n){function i(){this.off(u,i),n.apply(this,arguments)}return i.fn=n,this.on(u,i),this};st.prototype.off=st.prototype.removeListener=st.prototype.removeAllListeners=st.prototype.removeEventListener=function(u,n){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var i=this._callbacks["$"+u];if(!i)return this;if(arguments.length==1)return delete this._callbacks["$"+u],this;for(var o,f=0;f<i.length;f++)if(o=i[f],o===n||o.fn===n){i.splice(f,1);break}return i.length===0&&delete this._callbacks["$"+u],this};st.prototype.emit=function(u){this._callbacks=this._callbacks||{};for(var n=new Array(arguments.length-1),i=this._callbacks["$"+u],o=1;o<arguments.length;o++)n[o-1]=arguments[o];if(i){i=i.slice(0);for(var o=0,f=i.length;o<f;++o)i[o].apply(this,n)}return this};st.prototype.emitReserved=st.prototype.emit;st.prototype.listeners=function(u){return this._callbacks=this._callbacks||{},this._callbacks["$"+u]||[]};st.prototype.hasListeners=function(u){return!!this.listeners(u).length};const Jr=typeof Promise=="function"&&typeof Promise.resolve=="function"?n=>Promise.resolve().then(n):(n,i)=>i(n,0),Ht=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Sv="arraybuffer";function Za(u,...n){return n.reduce((i,o)=>(u.hasOwnProperty(o)&&(i[o]=u[o]),i),{})}const Bv=Ht.setTimeout,Tv=Ht.clearTimeout;function Zr(u,n){n.useNativeTimers?(u.setTimeoutFn=Bv.bind(Ht),u.clearTimeoutFn=Tv.bind(Ht)):(u.setTimeoutFn=Ht.setTimeout.bind(Ht),u.clearTimeoutFn=Ht.clearTimeout.bind(Ht))}const Av=1.33;function Cv(u){return typeof u=="string"?Ev(u):Math.ceil((u.byteLength||u.size)*Av)}function Ev(u){let n=0,i=0;for(let o=0,f=u.length;o<f;o++)n=u.charCodeAt(o),n<128?i+=1:n<2048?i+=2:n<55296||n>=57344?i+=3:(o++,i+=4);return i}function Qa(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Pv(u){let n="";for(let i in u)u.hasOwnProperty(i)&&(n.length&&(n+="&"),n+=encodeURIComponent(i)+"="+encodeURIComponent(u[i]));return n}function Ov(u){let n={},i=u.split("&");for(let o=0,f=i.length;o<f;o++){let _=i[o].split("=");n[decodeURIComponent(_[0])]=decodeURIComponent(_[1])}return n}class Rv extends Error{constructor(n,i,o){super(n),this.description=i,this.context=o,this.type="TransportError"}}class Ds extends st{constructor(n){super(),this.writable=!1,Zr(this,n),this.opts=n,this.query=n.query,this.socket=n.socket,this.supportsBinary=!n.forceBase64}onError(n,i,o){return super.emitReserved("error",new Rv(n,i,o)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(n){this.readyState==="open"&&this.write(n)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(n){const i=Ns(n,this.socket.binaryType);this.onPacket(i)}onPacket(n){super.emitReserved("packet",n)}onClose(n){this.readyState="closed",super.emitReserved("close",n)}pause(n){}createUri(n,i={}){return n+"://"+this._hostname()+this._port()+this.opts.path+this._query(i)}_hostname(){const n=this.opts.hostname;return n.indexOf(":")===-1?n:"["+n+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(n){const i=Pv(n);return i.length?"?"+i:""}}class Iv extends Ds{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(n){this.readyState="pausing";const i=()=>{this.readyState="paused",n()};if(this._polling||!this.writable){let o=0;this._polling&&(o++,this.once("pollComplete",function(){--o||i()})),this.writable||(o++,this.once("drain",function(){--o||i()}))}else i()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(n){const i=o=>{if(this.readyState==="opening"&&o.type==="open"&&this.onOpen(),o.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(o)};yv(n,this.socket.binaryType).forEach(i),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const n=()=>{this.write([{type:"close"}])};this.readyState==="open"?n():this.once("open",n)}write(n){this.writable=!1,mv(n,i=>{this.doWrite(i,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const n=this.opts.secure?"https":"http",i=this.query||{};return this.opts.timestampRequests!==!1&&(i[this.opts.timestampParam]=Qa()),!this.supportsBinary&&!i.sid&&(i.b64=1),this.createUri(n,i)}}let ja=!1;try{ja=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Lv=ja;function kv(){}class Mv extends Iv{constructor(n){if(super(n),typeof location<"u"){const i=location.protocol==="https:";let o=location.port;o||(o=i?"443":"80"),this.xd=typeof location<"u"&&n.hostname!==location.hostname||o!==n.port}}doWrite(n,i){const o=this.request({method:"POST",data:n});o.on("success",i),o.on("error",(f,_)=>{this.onError("xhr post error",f,_)})}doPoll(){const n=this.request();n.on("data",this.onData.bind(this)),n.on("error",(i,o)=>{this.onError("xhr poll error",i,o)}),this.pollXhr=n}}class re extends st{constructor(n,i,o){super(),this.createRequest=n,Zr(this,o),this._opts=o,this._method=o.method||"GET",this._uri=i,this._data=o.data!==void 0?o.data:null,this._create()}_create(){var n;const i=Za(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");i.xdomain=!!this._opts.xd;const o=this._xhr=this.createRequest(i);try{o.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){o.setDisableHeaderCheck&&o.setDisableHeaderCheck(!0);for(let f in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(f)&&o.setRequestHeader(f,this._opts.extraHeaders[f])}}catch{}if(this._method==="POST")try{o.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{o.setRequestHeader("Accept","*/*")}catch{}(n=this._opts.cookieJar)===null||n===void 0||n.addCookies(o),"withCredentials"in o&&(o.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(o.timeout=this._opts.requestTimeout),o.onreadystatechange=()=>{var f;o.readyState===3&&((f=this._opts.cookieJar)===null||f===void 0||f.parseCookies(o.getResponseHeader("set-cookie"))),o.readyState===4&&(o.status===200||o.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof o.status=="number"?o.status:0)},0))},o.send(this._data)}catch(f){this.setTimeoutFn(()=>{this._onError(f)},0);return}typeof document<"u"&&(this._index=re.requestsCount++,re.requests[this._index]=this)}_onError(n){this.emitReserved("error",n,this._xhr),this._cleanup(!0)}_cleanup(n){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=kv,n)try{this._xhr.abort()}catch{}typeof document<"u"&&delete re.requests[this._index],this._xhr=null}}_onLoad(){const n=this._xhr.responseText;n!==null&&(this.emitReserved("data",n),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}re.requestsCount=0;re.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Ea);else if(typeof addEventListener=="function"){const u="onpagehide"in Ht?"pagehide":"unload";addEventListener(u,Ea,!1)}}function Ea(){for(let u in re.requests)re.requests.hasOwnProperty(u)&&re.requests[u].abort()}const Nv=function(){const u=tl({xdomain:!1});return u&&u.responseType!==null}();class Dv extends Mv{constructor(n){super(n);const i=n&&n.forceBase64;this.supportsBinary=Nv&&!i}request(n={}){return Object.assign(n,{xd:this.xd},this.opts),new re(tl,this.uri(),n)}}function tl(u){const n=u.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!n||Lv))return new XMLHttpRequest}catch{}if(!n)try{return new Ht[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const el=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Wv extends Ds{get name(){return"websocket"}doOpen(){const n=this.uri(),i=this.opts.protocols,o=el?{}:Za(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(o.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(n,i,o)}catch(f){return this.emitReserved("error",f)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=n=>this.onClose({description:"websocket connection closed",context:n}),this.ws.onmessage=n=>this.onData(n.data),this.ws.onerror=n=>this.onError("websocket error",n)}write(n){this.writable=!1;for(let i=0;i<n.length;i++){const o=n[i],f=i===n.length-1;Ms(o,this.supportsBinary,_=>{try{this.doWrite(o,_)}catch{}f&&Jr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const n=this.opts.secure?"wss":"ws",i=this.query||{};return this.opts.timestampRequests&&(i[this.opts.timestampParam]=Qa()),this.supportsBinary||(i.b64=1),this.createUri(n,i)}}const Ss=Ht.WebSocket||Ht.MozWebSocket;class Fv extends Wv{createSocket(n,i,o){return el?new Ss(n,i,o):i?new Ss(n,i):new Ss(n)}doWrite(n,i){this.ws.send(i)}}class Uv extends Ds{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(n){return this.emitReserved("error",n)}this._transport.closed.then(()=>{this.onClose()}).catch(n=>{this.onError("webtransport error",n)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(n=>{const i=xv(Number.MAX_SAFE_INTEGER,this.socket.binaryType),o=n.readable.pipeThrough(i).getReader(),f=wv();f.readable.pipeTo(n.writable),this._writer=f.writable.getWriter();const _=()=>{o.read().then(({done:P,value:L})=>{P||(this.onPacket(L),_())}).catch(P=>{})};_();const b={type:"open"};this.query.sid&&(b.data=`{"sid":"${this.query.sid}"}`),this._writer.write(b).then(()=>this.onOpen())})})}write(n){this.writable=!1;for(let i=0;i<n.length;i++){const o=n[i],f=i===n.length-1;this._writer.write(o).then(()=>{f&&Jr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var n;(n=this._transport)===null||n===void 0||n.close()}}const Hv={websocket:Fv,webtransport:Uv,polling:Dv},Gv=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,qv=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Ps(u){if(u.length>8e3)throw"URI too long";const n=u,i=u.indexOf("["),o=u.indexOf("]");i!=-1&&o!=-1&&(u=u.substring(0,i)+u.substring(i,o).replace(/:/g,";")+u.substring(o,u.length));let f=Gv.exec(u||""),_={},b=14;for(;b--;)_[qv[b]]=f[b]||"";return i!=-1&&o!=-1&&(_.source=n,_.host=_.host.substring(1,_.host.length-1).replace(/;/g,":"),_.authority=_.authority.replace("[","").replace("]","").replace(/;/g,":"),_.ipv6uri=!0),_.pathNames=$v(_,_.path),_.queryKey=Kv(_,_.query),_}function $v(u,n){const i=/\/{2,9}/g,o=n.replace(i,"/").split("/");return(n.slice(0,1)=="/"||n.length===0)&&o.splice(0,1),n.slice(-1)=="/"&&o.splice(o.length-1,1),o}function Kv(u,n){const i={};return n.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(o,f,_){f&&(i[f]=_)}),i}const Os=typeof addEventListener=="function"&&typeof removeEventListener=="function",$r=[];Os&&addEventListener("offline",()=>{$r.forEach(u=>u())},!1);class Le extends st{constructor(n,i){if(super(),this.binaryType=Sv,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,n&&typeof n=="object"&&(i=n,n=null),n){const o=Ps(n);i.hostname=o.host,i.secure=o.protocol==="https"||o.protocol==="wss",i.port=o.port,o.query&&(i.query=o.query)}else i.host&&(i.hostname=Ps(i.host).host);Zr(this,i),this.secure=i.secure!=null?i.secure:typeof location<"u"&&location.protocol==="https:",i.hostname&&!i.port&&(i.port=this.secure?"443":"80"),this.hostname=i.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=i.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},i.transports.forEach(o=>{const f=o.prototype.name;this.transports.push(f),this._transportsByName[f]=o}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},i),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Ov(this.opts.query)),Os&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},$r.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(n){const i=Object.assign({},this.opts.query);i.EIO=Ja,i.transport=n,this.id&&(i.sid=this.id);const o=Object.assign({},this.opts,{query:i,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[n]);return new this._transportsByName[n](o)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const n=this.opts.rememberUpgrade&&Le.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const i=this.createTransport(n);i.open(),this.setTransport(i)}setTransport(n){this.transport&&this.transport.removeAllListeners(),this.transport=n,n.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",i=>this._onClose("transport close",i))}onOpen(){this.readyState="open",Le.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",n),this.emitReserved("heartbeat"),n.type){case"open":this.onHandshake(JSON.parse(n.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const i=new Error("server error");i.code=n.data,this._onError(i);break;case"message":this.emitReserved("data",n.data),this.emitReserved("message",n.data);break}}onHandshake(n){this.emitReserved("handshake",n),this.id=n.sid,this.transport.query.sid=n.sid,this._pingInterval=n.pingInterval,this._pingTimeout=n.pingTimeout,this._maxPayload=n.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const n=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+n,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},n),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const n=this._getWritablePackets();this.transport.send(n),this._prevBufferLen=n.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let i=1;for(let o=0;o<this.writeBuffer.length;o++){const f=this.writeBuffer[o].data;if(f&&(i+=Cv(f)),o>0&&i>this._maxPayload)return this.writeBuffer.slice(0,o);i+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const n=Date.now()>this._pingTimeoutTime;return n&&(this._pingTimeoutTime=0,Jr(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),n}write(n,i,o){return this._sendPacket("message",n,i,o),this}send(n,i,o){return this._sendPacket("message",n,i,o),this}_sendPacket(n,i,o,f){if(typeof i=="function"&&(f=i,i=void 0),typeof o=="function"&&(f=o,o=null),this.readyState==="closing"||this.readyState==="closed")return;o=o||{},o.compress=o.compress!==!1;const _={type:n,data:i,options:o};this.emitReserved("packetCreate",_),this.writeBuffer.push(_),f&&this.once("flush",f),this.flush()}close(){const n=()=>{this._onClose("forced close"),this.transport.close()},i=()=>{this.off("upgrade",i),this.off("upgradeError",i),n()},o=()=>{this.once("upgrade",i),this.once("upgradeError",i)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?o():n()}):this.upgrading?o():n()),this}_onError(n){if(Le.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",n),this._onClose("transport error",n)}_onClose(n,i){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Os&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const o=$r.indexOf(this._offlineEventListener);o!==-1&&$r.splice(o,1)}this.readyState="closed",this.id=null,this.emitReserved("close",n,i),this.writeBuffer=[],this._prevBufferLen=0}}}Le.protocol=Ja;class Yv extends Le{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let n=0;n<this._upgrades.length;n++)this._probe(this._upgrades[n])}_probe(n){let i=this.createTransport(n),o=!1;Le.priorWebsocketSuccess=!1;const f=()=>{o||(i.send([{type:"ping",data:"probe"}]),i.once("packet",F=>{if(!o)if(F.type==="pong"&&F.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",i),!i)return;Le.priorWebsocketSuccess=i.name==="websocket",this.transport.pause(()=>{o||this.readyState!=="closed"&&(tt(),this.setTransport(i),i.send([{type:"upgrade"}]),this.emitReserved("upgrade",i),i=null,this.upgrading=!1,this.flush())})}else{const Zt=new Error("probe error");Zt.transport=i.name,this.emitReserved("upgradeError",Zt)}}))};function _(){o||(o=!0,tt(),i.close(),i=null)}const b=F=>{const Zt=new Error("probe error: "+F);Zt.transport=i.name,_(),this.emitReserved("upgradeError",Zt)};function P(){b("transport closed")}function L(){b("socket closed")}function ct(F){i&&F.name!==i.name&&_()}const tt=()=>{i.removeListener("open",f),i.removeListener("error",b),i.removeListener("close",P),this.off("close",L),this.off("upgrading",ct)};i.once("open",f),i.once("error",b),i.once("close",P),this.once("close",L),this.once("upgrading",ct),this._upgrades.indexOf("webtransport")!==-1&&n!=="webtransport"?this.setTimeoutFn(()=>{o||i.open()},200):i.open()}onHandshake(n){this._upgrades=this._filterUpgrades(n.upgrades),super.onHandshake(n)}_filterUpgrades(n){const i=[];for(let o=0;o<n.length;o++)~this.transports.indexOf(n[o])&&i.push(n[o]);return i}}let Xv=class extends Yv{constructor(n,i={}){const o=typeof n=="object"?n:i;(!o.transports||o.transports&&typeof o.transports[0]=="string")&&(o.transports=(o.transports||["polling","websocket","webtransport"]).map(f=>Hv[f]).filter(f=>!!f)),super(n,o)}};function zv(u,n="",i){let o=u;i=i||typeof location<"u"&&location,u==null&&(u=i.protocol+"//"+i.host),typeof u=="string"&&(u.charAt(0)==="/"&&(u.charAt(1)==="/"?u=i.protocol+u:u=i.host+u),/^(https?|wss?):\/\//.test(u)||(typeof i<"u"?u=i.protocol+"//"+u:u="https://"+u),o=Ps(u)),o.port||(/^(http|ws)$/.test(o.protocol)?o.port="80":/^(http|ws)s$/.test(o.protocol)&&(o.port="443")),o.path=o.path||"/";const _=o.host.indexOf(":")!==-1?"["+o.host+"]":o.host;return o.id=o.protocol+"://"+_+":"+o.port+n,o.href=o.protocol+"://"+_+(i&&i.port===o.port?"":":"+o.port),o}const Vv=typeof ArrayBuffer=="function",Jv=u=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(u):u.buffer instanceof ArrayBuffer,nl=Object.prototype.toString,Zv=typeof Blob=="function"||typeof Blob<"u"&&nl.call(Blob)==="[object BlobConstructor]",Qv=typeof File=="function"||typeof File<"u"&&nl.call(File)==="[object FileConstructor]";function Ws(u){return Vv&&(u instanceof ArrayBuffer||Jv(u))||Zv&&u instanceof Blob||Qv&&u instanceof File}function Kr(u,n){if(!u||typeof u!="object")return!1;if(Array.isArray(u)){for(let i=0,o=u.length;i<o;i++)if(Kr(u[i]))return!0;return!1}if(Ws(u))return!0;if(u.toJSON&&typeof u.toJSON=="function"&&arguments.length===1)return Kr(u.toJSON(),!0);for(const i in u)if(Object.prototype.hasOwnProperty.call(u,i)&&Kr(u[i]))return!0;return!1}function jv(u){const n=[],i=u.data,o=u;return o.data=Rs(i,n),o.attachments=n.length,{packet:o,buffers:n}}function Rs(u,n){if(!u)return u;if(Ws(u)){const i={_placeholder:!0,num:n.length};return n.push(u),i}else if(Array.isArray(u)){const i=new Array(u.length);for(let o=0;o<u.length;o++)i[o]=Rs(u[o],n);return i}else if(typeof u=="object"&&!(u instanceof Date)){const i={};for(const o in u)Object.prototype.hasOwnProperty.call(u,o)&&(i[o]=Rs(u[o],n));return i}return u}function tm(u,n){return u.data=Is(u.data,n),delete u.attachments,u}function Is(u,n){if(!u)return u;if(u&&u._placeholder===!0){if(typeof u.num=="number"&&u.num>=0&&u.num<n.length)return n[u.num];throw new Error("illegal attachments")}else if(Array.isArray(u))for(let i=0;i<u.length;i++)u[i]=Is(u[i],n);else if(typeof u=="object")for(const i in u)Object.prototype.hasOwnProperty.call(u,i)&&(u[i]=Is(u[i],n));return u}const em=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],nm=5;var $;(function(u){u[u.CONNECT=0]="CONNECT",u[u.DISCONNECT=1]="DISCONNECT",u[u.EVENT=2]="EVENT",u[u.ACK=3]="ACK",u[u.CONNECT_ERROR=4]="CONNECT_ERROR",u[u.BINARY_EVENT=5]="BINARY_EVENT",u[u.BINARY_ACK=6]="BINARY_ACK"})($||($={}));class rm{constructor(n){this.replacer=n}encode(n){return(n.type===$.EVENT||n.type===$.ACK)&&Kr(n)?this.encodeAsBinary({type:n.type===$.EVENT?$.BINARY_EVENT:$.BINARY_ACK,nsp:n.nsp,data:n.data,id:n.id}):[this.encodeAsString(n)]}encodeAsString(n){let i=""+n.type;return(n.type===$.BINARY_EVENT||n.type===$.BINARY_ACK)&&(i+=n.attachments+"-"),n.nsp&&n.nsp!=="/"&&(i+=n.nsp+","),n.id!=null&&(i+=n.id),n.data!=null&&(i+=JSON.stringify(n.data,this.replacer)),i}encodeAsBinary(n){const i=jv(n),o=this.encodeAsString(i.packet),f=i.buffers;return f.unshift(o),f}}function Pa(u){return Object.prototype.toString.call(u)==="[object Object]"}class Fs extends st{constructor(n){super(),this.reviver=n}add(n){let i;if(typeof n=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");i=this.decodeString(n);const o=i.type===$.BINARY_EVENT;o||i.type===$.BINARY_ACK?(i.type=o?$.EVENT:$.ACK,this.reconstructor=new im(i),i.attachments===0&&super.emitReserved("decoded",i)):super.emitReserved("decoded",i)}else if(Ws(n)||n.base64)if(this.reconstructor)i=this.reconstructor.takeBinaryData(n),i&&(this.reconstructor=null,super.emitReserved("decoded",i));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+n)}decodeString(n){let i=0;const o={type:Number(n.charAt(0))};if($[o.type]===void 0)throw new Error("unknown packet type "+o.type);if(o.type===$.BINARY_EVENT||o.type===$.BINARY_ACK){const _=i+1;for(;n.charAt(++i)!=="-"&&i!=n.length;);const b=n.substring(_,i);if(b!=Number(b)||n.charAt(i)!=="-")throw new Error("Illegal attachments");o.attachments=Number(b)}if(n.charAt(i+1)==="/"){const _=i+1;for(;++i&&!(n.charAt(i)===","||i===n.length););o.nsp=n.substring(_,i)}else o.nsp="/";const f=n.charAt(i+1);if(f!==""&&Number(f)==f){const _=i+1;for(;++i;){const b=n.charAt(i);if(b==null||Number(b)!=b){--i;break}if(i===n.length)break}o.id=Number(n.substring(_,i+1))}if(n.charAt(++i)){const _=this.tryParse(n.substr(i));if(Fs.isPayloadValid(o.type,_))o.data=_;else throw new Error("invalid payload")}return o}tryParse(n){try{return JSON.parse(n,this.reviver)}catch{return!1}}static isPayloadValid(n,i){switch(n){case $.CONNECT:return Pa(i);case $.DISCONNECT:return i===void 0;case $.CONNECT_ERROR:return typeof i=="string"||Pa(i);case $.EVENT:case $.BINARY_EVENT:return Array.isArray(i)&&(typeof i[0]=="number"||typeof i[0]=="string"&&em.indexOf(i[0])===-1);case $.ACK:case $.BINARY_ACK:return Array.isArray(i)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class im{constructor(n){this.packet=n,this.buffers=[],this.reconPack=n}takeBinaryData(n){if(this.buffers.push(n),this.buffers.length===this.reconPack.attachments){const i=tm(this.reconPack,this.buffers);return this.finishedReconstruction(),i}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const sm=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Fs,Encoder:rm,get PacketType(){return $},protocol:nm},Symbol.toStringTag,{value:"Module"}));function Jt(u,n,i){return u.on(n,i),function(){u.off(n,i)}}const om=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class rl extends st{constructor(n,i,o){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=n,this.nsp=i,o&&o.auth&&(this.auth=o.auth),this._opts=Object.assign({},o),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const n=this.io;this.subs=[Jt(n,"open",this.onopen.bind(this)),Jt(n,"packet",this.onpacket.bind(this)),Jt(n,"error",this.onerror.bind(this)),Jt(n,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...n){return n.unshift("message"),this.emit.apply(this,n),this}emit(n,...i){var o,f,_;if(om.hasOwnProperty(n))throw new Error('"'+n.toString()+'" is a reserved event name');if(i.unshift(n),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(i),this;const b={type:$.EVENT,data:i};if(b.options={},b.options.compress=this.flags.compress!==!1,typeof i[i.length-1]=="function"){const tt=this.ids++,F=i.pop();this._registerAckCallback(tt,F),b.id=tt}const P=(f=(o=this.io.engine)===null||o===void 0?void 0:o.transport)===null||f===void 0?void 0:f.writable,L=this.connected&&!(!((_=this.io.engine)===null||_===void 0)&&_._hasPingExpired());return this.flags.volatile&&!P||(L?(this.notifyOutgoingListeners(b),this.packet(b)):this.sendBuffer.push(b)),this.flags={},this}_registerAckCallback(n,i){var o;const f=(o=this.flags.timeout)!==null&&o!==void 0?o:this._opts.ackTimeout;if(f===void 0){this.acks[n]=i;return}const _=this.io.setTimeoutFn(()=>{delete this.acks[n];for(let P=0;P<this.sendBuffer.length;P++)this.sendBuffer[P].id===n&&this.sendBuffer.splice(P,1);i.call(this,new Error("operation has timed out"))},f),b=(...P)=>{this.io.clearTimeoutFn(_),i.apply(this,P)};b.withError=!0,this.acks[n]=b}emitWithAck(n,...i){return new Promise((o,f)=>{const _=(b,P)=>b?f(b):o(P);_.withError=!0,i.push(_),this.emit(n,...i)})}_addToQueue(n){let i;typeof n[n.length-1]=="function"&&(i=n.pop());const o={id:this._queueSeq++,tryCount:0,pending:!1,args:n,flags:Object.assign({fromQueue:!0},this.flags)};n.push((f,..._)=>o!==this._queue[0]?void 0:(f!==null?o.tryCount>this._opts.retries&&(this._queue.shift(),i&&i(f)):(this._queue.shift(),i&&i(null,..._)),o.pending=!1,this._drainQueue())),this._queue.push(o),this._drainQueue()}_drainQueue(n=!1){if(!this.connected||this._queue.length===0)return;const i=this._queue[0];i.pending&&!n||(i.pending=!0,i.tryCount++,this.flags=i.flags,this.emit.apply(this,i.args))}packet(n){n.nsp=this.nsp,this.io._packet(n)}onopen(){typeof this.auth=="function"?this.auth(n=>{this._sendConnectPacket(n)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(n){this.packet({type:$.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},n):n})}onerror(n){this.connected||this.emitReserved("connect_error",n)}onclose(n,i){this.connected=!1,delete this.id,this.emitReserved("disconnect",n,i),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(n=>{if(!this.sendBuffer.some(o=>String(o.id)===n)){const o=this.acks[n];delete this.acks[n],o.withError&&o.call(this,new Error("socket has been disconnected"))}})}onpacket(n){if(n.nsp===this.nsp)switch(n.type){case $.CONNECT:n.data&&n.data.sid?this.onconnect(n.data.sid,n.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case $.EVENT:case $.BINARY_EVENT:this.onevent(n);break;case $.ACK:case $.BINARY_ACK:this.onack(n);break;case $.DISCONNECT:this.ondisconnect();break;case $.CONNECT_ERROR:this.destroy();const o=new Error(n.data.message);o.data=n.data.data,this.emitReserved("connect_error",o);break}}onevent(n){const i=n.data||[];n.id!=null&&i.push(this.ack(n.id)),this.connected?this.emitEvent(i):this.receiveBuffer.push(Object.freeze(i))}emitEvent(n){if(this._anyListeners&&this._anyListeners.length){const i=this._anyListeners.slice();for(const o of i)o.apply(this,n)}super.emit.apply(this,n),this._pid&&n.length&&typeof n[n.length-1]=="string"&&(this._lastOffset=n[n.length-1])}ack(n){const i=this;let o=!1;return function(...f){o||(o=!0,i.packet({type:$.ACK,id:n,data:f}))}}onack(n){const i=this.acks[n.id];typeof i=="function"&&(delete this.acks[n.id],i.withError&&n.data.unshift(null),i.apply(this,n.data))}onconnect(n,i){this.id=n,this.recovered=i&&this._pid===i,this._pid=i,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(n=>this.emitEvent(n)),this.receiveBuffer=[],this.sendBuffer.forEach(n=>{this.notifyOutgoingListeners(n),this.packet(n)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(n=>n()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:$.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(n){return this.flags.compress=n,this}get volatile(){return this.flags.volatile=!0,this}timeout(n){return this.flags.timeout=n,this}onAny(n){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(n),this}prependAny(n){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(n),this}offAny(n){if(!this._anyListeners)return this;if(n){const i=this._anyListeners;for(let o=0;o<i.length;o++)if(n===i[o])return i.splice(o,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(n){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(n),this}prependAnyOutgoing(n){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(n),this}offAnyOutgoing(n){if(!this._anyOutgoingListeners)return this;if(n){const i=this._anyOutgoingListeners;for(let o=0;o<i.length;o++)if(n===i[o])return i.splice(o,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(n){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const i=this._anyOutgoingListeners.slice();for(const o of i)o.apply(this,n.data)}}}function hn(u){u=u||{},this.ms=u.min||100,this.max=u.max||1e4,this.factor=u.factor||2,this.jitter=u.jitter>0&&u.jitter<=1?u.jitter:0,this.attempts=0}hn.prototype.duration=function(){var u=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var n=Math.random(),i=Math.floor(n*this.jitter*u);u=(Math.floor(n*10)&1)==0?u-i:u+i}return Math.min(u,this.max)|0};hn.prototype.reset=function(){this.attempts=0};hn.prototype.setMin=function(u){this.ms=u};hn.prototype.setMax=function(u){this.max=u};hn.prototype.setJitter=function(u){this.jitter=u};let Ls=class extends st{constructor(n,i){var o;super(),this.nsps={},this.subs=[],n&&typeof n=="object"&&(i=n,n=void 0),i=i||{},i.path=i.path||"/socket.io",this.opts=i,Zr(this,i),this.reconnection(i.reconnection!==!1),this.reconnectionAttempts(i.reconnectionAttempts||1/0),this.reconnectionDelay(i.reconnectionDelay||1e3),this.reconnectionDelayMax(i.reconnectionDelayMax||5e3),this.randomizationFactor((o=i.randomizationFactor)!==null&&o!==void 0?o:.5),this.backoff=new hn({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(i.timeout==null?2e4:i.timeout),this._readyState="closed",this.uri=n;const f=i.parser||sm;this.encoder=new f.Encoder,this.decoder=new f.Decoder,this._autoConnect=i.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(n){return arguments.length?(this._reconnection=!!n,n||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(n){return n===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=n,this)}reconnectionDelay(n){var i;return n===void 0?this._reconnectionDelay:(this._reconnectionDelay=n,(i=this.backoff)===null||i===void 0||i.setMin(n),this)}randomizationFactor(n){var i;return n===void 0?this._randomizationFactor:(this._randomizationFactor=n,(i=this.backoff)===null||i===void 0||i.setJitter(n),this)}reconnectionDelayMax(n){var i;return n===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=n,(i=this.backoff)===null||i===void 0||i.setMax(n),this)}timeout(n){return arguments.length?(this._timeout=n,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(n){if(~this._readyState.indexOf("open"))return this;this.engine=new Xv(this.uri,this.opts);const i=this.engine,o=this;this._readyState="opening",this.skipReconnect=!1;const f=Jt(i,"open",function(){o.onopen(),n&&n()}),_=P=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",P),n?n(P):this.maybeReconnectOnOpen()},b=Jt(i,"error",_);if(this._timeout!==!1){const P=this._timeout,L=this.setTimeoutFn(()=>{f(),_(new Error("timeout")),i.close()},P);this.opts.autoUnref&&L.unref(),this.subs.push(()=>{this.clearTimeoutFn(L)})}return this.subs.push(f),this.subs.push(b),this}connect(n){return this.open(n)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const n=this.engine;this.subs.push(Jt(n,"ping",this.onping.bind(this)),Jt(n,"data",this.ondata.bind(this)),Jt(n,"error",this.onerror.bind(this)),Jt(n,"close",this.onclose.bind(this)),Jt(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(n){try{this.decoder.add(n)}catch(i){this.onclose("parse error",i)}}ondecoded(n){Jr(()=>{this.emitReserved("packet",n)},this.setTimeoutFn)}onerror(n){this.emitReserved("error",n)}socket(n,i){let o=this.nsps[n];return o?this._autoConnect&&!o.active&&o.connect():(o=new rl(this,n,i),this.nsps[n]=o),o}_destroy(n){const i=Object.keys(this.nsps);for(const o of i)if(this.nsps[o].active)return;this._close()}_packet(n){const i=this.encoder.encode(n);for(let o=0;o<i.length;o++)this.engine.write(i[o],n.options)}cleanup(){this.subs.forEach(n=>n()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(n,i){var o;this.cleanup(),(o=this.engine)===null||o===void 0||o.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",n,i),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const n=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const i=this.backoff.duration();this._reconnecting=!0;const o=this.setTimeoutFn(()=>{n.skipReconnect||(this.emitReserved("reconnect_attempt",n.backoff.attempts),!n.skipReconnect&&n.open(f=>{f?(n._reconnecting=!1,n.reconnect(),this.emitReserved("reconnect_error",f)):n.onreconnect()}))},i);this.opts.autoUnref&&o.unref(),this.subs.push(()=>{this.clearTimeoutFn(o)})}}onreconnect(){const n=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",n)}};const Wn={};function Yr(u,n){typeof u=="object"&&(n=u,u=void 0),n=n||{};const i=zv(u,n.path||"/socket.io"),o=i.source,f=i.id,_=i.path,b=Wn[f]&&_ in Wn[f].nsps,P=n.forceNew||n["force new connection"]||n.multiplex===!1||b;let L;return P?L=new Ls(o,n):(Wn[f]||(Wn[f]=new Ls(o,n)),L=Wn[f]),i.query&&!n.query&&(n.query=i.queryKey),L.socket(i.path,n)}Object.assign(Yr,{Manager:Ls,Socket:rl,io:Yr,connect:Yr});function um(u){const n=u.get("gameId"),i=u.get("playerId"),o=u.get("opponentId"),f=u.get("gameName"),_=u.get("lobbyId"),b=u.get("lobbyCode");return{gameId:n,playerId:i,opponentId:o,gameName:f,lobbyId:_,lobbyCode:b}}const il=new URL(window.location.href);console.log(il);const am=il.search,lm=new URLSearchParams(am),ks=um(lm);console.log(ks);const y={serverData:ks,mouseDown:!1,firstPlay:!0,cue:{x:413,y:413},opponentInvalidCue:!1,isDraggingCue:!1,cueStartPos:{x:100,y:100},stickAngle:0,isRotating:!1,previousAngle:0,socket:Yr("http://localhost:5657/snooker"),currentTurn:1,myPlayerNumber:0,started:!1,lobbyCode:ks.lobbyCode,domTurn:document.getElementById("turn"),domTime:document.getElementById("time"),p1aDiv:document.getElementById("p1a-div"),p1a:document.getElementById("p1a"),p1u:document.getElementById("p1u"),p2aDiv:document.getElementById("p2a-div"),p2a:document.getElementById("p2a"),p2u:document.getElementById("p2u")};function wt(){return y.myPlayerNumber==y.currentTurn}function sl(u,n,i,o){const f=al(u,o),_=f.x/n,b=f.y/i;if(y.cue&&mm(_,b,y.cue.x,y.cue.y)<=19&&(y.opponentInvalidCue||y.firstPlay)){y.isDraggingCue=!0,y.cueStartPos={x:y.cue.x,y:y.cue.y},o.style.cursor="grabbing";return}else console.log("rotating????"),y.isRotating=!0,ul(u,n,i,o)}function ol(u,n,i,o){if((!y.isDraggingCue||!y.cue)&&y.mouseDown){if(console.log("stick??"),!y.isRotating)return;ul(u,n,i,o);return}if(!y.mouseDown)return;u.preventDefault();const f=al(u,o),_=f.x/n,b=f.y/i;if(y.cue.x=_,y.cue.y=b,y.firstPlay)if(y.cue.x>413){console.log("invalid");return}else y.socket.emit("move_cue",y.lobbyCode,{x:y.cue.x,y:y.cue.y});else y.socket.emit("move_cue",y.lobbyCode,{x:y.cue.x,y:y.cue.y})}function Us(u){y.isDraggingCue&&(y.isDraggingCue=!1,u.style.cursor="",(y.cue.x!==y.cueStartPos.x||y.cue.y!==y.cueStartPos.y)&&y.socket.emit("move_cue",y.lobbyCode,{x:y.cue.x,y:y.cue.y})),cm()}function cm(){y.isRotating=!1}function ul(u,n,i,o){const f=o.getBoundingClientRect(),_=u.clientX||u.touches[0].clientX,b=u.clientY||u.touches[0].clientY,P=(_-f.left)/n,L=(b-f.top)/i;y.previousAngle=y.stickAngle,y.stickAngle=Math.atan2(L-y.cue.y,P-y.cue.x),hm(y.stickAngle)}function hm(u){y.socket.emit("rotate_stick",y.lobbyCode,u)}const Hs=document.createElement("div");Hs.id="base";const Gt=document.createElement("div");Gt.id="power";Hs.appendChild(Gt);document.body.appendChild(Hs);let Gs=!1;const cn=500,Xr=100;let ke,fn,lt,zr=0;function fm(u){console.log("touch start"),ke=u.touches[0].pageX,fn=u.touches[0].pageY}function pm(u){ke-u.touches[0].pageX,lt=Math.abs(fn-u.touches[0].pageY),lt>0&&lt<=cn?Gt.style.translate=`${lt*-1}px 0`:lt<=0&&(lt=0)}function dm(u){lt>0&&(zr=lt>cn?Xr:lt/cn*Xr,y.socket.emit("strike",y.lobbyCode,{angle:y.stickAngle,force:zr}),y.firstPlay=!1,y.opponentInvalidCue=!1),ke=0,fn=0,Gt.style.translate=`${ke}px 0`}function gm(u){ke=u.pageX,fn=u.pageY}function _m(u){ke-u.pageX,lt=Math.abs(fn-u.pageY),lt>0&&lt<=cn?Gt.style.translate=`${lt*-1}px 0`:lt<=0&&(lt=0)}function vm(u){lt>0&&(zr=lt>cn?Xr:lt/cn*Xr,console.log("strike"),y.socket.emit("strike",y.lobbyCode,{angle:y.stickAngle,force:zr}),y.firstPlay=!1,y.opponentInvalidCue=!1),ke=0,fn=0,Gt.style.translate=`${ke}px 0`}Gt.addEventListener("mousedown",u=>{y.started&&wt()&&(Gs=!0,console.log("handle start"),gm(u))});Gt.addEventListener("mousemove",u=>{y.started&&wt()&&Gs&&(console.log("handle move"),_m(u))});Gt.addEventListener("mouseup",u=>{y.started&&wt()&&(Gs=!1,vm())});Gt.addEventListener("touchstart",u=>{y.started&&wt()&&fm(u)});Gt.addEventListener("touchmove",u=>{y.started&&wt()&&pm(u)});Gt.addEventListener("touchend",u=>{y.started&&wt()&&dm()});function al(u,n){const i=n.getBoundingClientRect();return{x:(u.clientX||u.touches[0].clientX)-i.left,y:(u.clientY||u.touches[0].clientY)-i.top}}function mm(u,n,i,o){return Math.sqrt((i-u)**2+(o-n)**2)}async function ym(u){try{const n=await fetch(`https://game-service-uny2.onrender.com/user-details/${u}`);if(!n.ok){alert("error fetching avatar and username, default data used");return}const i=await n.json();return{username:i.userGameDetails.username,avatar:i.userGameDetails.avatar}}catch(n){alert("error fetching avatar and username, default data used"),console.log(n)}}class wm{constructor(n,i){A(this,"_canvasContainer");A(this,"_canvas");A(this,"_context");A(this,"_scale");A(this,"_offset");this._canvasContainer=i,this._canvas=n,this._context=this._canvas.getContext("2d"),this.resizeCanvas()}get scaleX(){return this._scale.x}get scaleY(){return this._scale.y}get offsetX(){return this._offset.x}get offsetY(){return this._offset.y}resizeCanvas(){const n=E.gameSize.x,i=E.gameSize.y,o=n/i;let f=window.innerHeight/1.3,_=window.innerWidth/1.3;_/f>o?_=f*o:f=_/o,this._canvasContainer.style.width=_+"px",this._canvasContainer.style.height=f+"px",this._scale=new D(_/n,f/i),this._canvas.width=_,this._canvas.height=f,this._canvas.offsetParent&&(this._offset=new D(this._canvas.offsetLeft,this._canvas.offsetTop))}clear(){this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}drawImage(n,i={x:0,y:0},o=0,f={x:0,y:0}){this._context.save(),this._context.scale(this._scale.x,this._scale.y),this._context.translate(i.x,i.y),this._context.rotate(o),this._context.drawImage(n,0,0,n.width,n.height,-f.x,-f.y,n.width,n.height),this._context.restore()}drawText(n,i,o,f,_="left"){this._context.save(),this._context.scale(this._scale.x,this._scale.y),this._context.fillStyle=o,this._context.font=i,this._context.textAlign=_,this._context.fillText(n,f.x,f.y),this._context.restore()}changeCursor(n){this._canvas.style.cursor=n}}const xt=document.getElementById("screen"),xm=document.getElementById("gameArea"),z=new wm(xt,xm);window.addEventListener("resize",z.resizeCanvas.bind(z));xt.addEventListener("mousedown",u=>{console.log(y.started),wt()&&y.started&&(y.mouseDown=!0,sl(u,z.scaleX,z.scaleY,xt))});xt.addEventListener("mousemove",u=>{y.started&&wt()&&ol(u,z.scaleX,z.scaleY,xt)});xt.addEventListener("mouseup",u=>{y.started&&wt()&&(y.mouseDown=!1,Us(xt))});xt.addEventListener("mouseleave",u=>{y.started&&wt()&&(y.mouseDown=!1,Us(xt))});xt.addEventListener("touchstart",u=>{y.started&&wt()&&(y.mouseDown=!0,sl(u,z.scaleX,z.scaleY,xt))});xt.addEventListener("touchmove",u=>{y.started&&wt()&&ol(u,z.scaleX,z.scaleY,xt)});xt.addEventListener("touchend",u=>{y.started&&wt()&&(y.mouseDown=!1,Us(xt))});class bm{constructor(){A(this,"_buttonStates",[]);A(this,"_position");for(let n=0;n<3;n++)this._buttonStates[n]=new $a;this._position=D.zero,document.addEventListener("mousemove",n=>this.handleMouseMove(n)),document.addEventListener("mousedown",n=>this.handleMouseDown(n)),document.addEventListener("mouseup",n=>this.handleMouseUp(n))}get position(){return D.copy(this._position)}handleMouseMove(n){const i=(n.pageX-z.offsetX)/z.scaleX,o=(n.pageY-z.offsetY)/z.scaleY;this._position=new D(i,o)}handleMouseDown(n){this._buttonStates[n.button].down=!0,this._buttonStates[n.button].pressed=!0}handleMouseUp(n){this._buttonStates[n.button].down=!1}reset(){for(let n=0;n<3;n++)this._buttonStates[n].pressed=!1}isDown(n){return this._buttonStates[n].down}isPressed(n){return this._buttonStates[n].pressed}}const ye=new bm,{cloneDeep:Oa}=pv,Fn=E.ai,Ra=E.stick;class Sm{constructor(){A(this,"_policy");A(this,"_opponents");A(this,"_currentOpponent");A(this,"_initialGameWorld");A(this,"_gameWorld");A(this,"_iteration",0);A(this,"_finishedSession",!0);A(this,"_bestOpponent");A(this,"_soundOnState");this._policy=new av}get finishedSession(){return this._finishedSession}placeBallInHand(n){debugger;let i=5,o=D.copy(E.cueBallPosition);for(;!n.isValidPosToPlaceCueBall(o);)o.addToX(i);n.placeBallInHand(o)}init(){this._opponents=[],this._currentOpponent=this.createRandomOpponent(),this._bestOpponent=this._currentOpponent,this._iteration=0}createMutation(n){let i=n.power;i+=Math.random()*2*Fn.shotPowerMutationVariance-Fn.shotPowerMutationVariance,i=i<Fn.minShotPower?Fn.minShotPower:i,i=i>Ra.maxPower?Ra.maxPower:i;let o=n.rotation;return n.evaluation>0?o+=1/n.evaluation*(Math.random()*2*Math.PI-Math.PI):o=Math.random()*2*Math.PI-Math.PI,new ws(i,o)}createRandomOpponent(){const n=Math.random()*75+1,i=Math.random()*2*Math.PI;return new ws(n,i)}train(){if(this._iteration===Fn.trainIterations){E.soundOn=this._soundOnState,this.playTurn(),this._finishedSession=!0;return}if(this._gameWorld.isBallsMoving)return;this._gameWorld.concludeTurn(),this._currentOpponent.evaluation=this._policy.evaluate(this._gameWorld);const n=new ws(this._currentOpponent.power,this._currentOpponent.rotation,this._currentOpponent.evaluation);this._opponents.push(n),n.evaluation>this._bestOpponent.evaluation&&(this._bestOpponent=n),this._gameWorld=Oa(this._initialGameWorld),this._currentOpponent=this.buildNewOpponent(),this._iteration++,this.simulate()}buildNewOpponent(){return this._iteration%10===0?this.createRandomOpponent():this.createMutation(this._bestOpponent)}playTurn(){this._initialGameWorld.shootCueBall(this._bestOpponent.power,this._bestOpponent.rotation)}simulate(){this._gameWorld.shootCueBall(this._currentOpponent.power,this._currentOpponent.rotation)}opponentTrainingLoop(){for(;!this._finishedSession;)this.train(),this._gameWorld.update();ye.reset()}startSession(n){this._soundOnState=E.soundOn,E.soundOn=!1,n.isBallInHand&&this.placeBallInHand(n),this._initialGameWorld=n,this._gameWorld=Oa(n),this.init(),this._finishedSession=!1,this.simulate(),this.opponentTrainingLoop()}}const Gn=new Sm;class Bm{constructor(n){this._game=n}execute(){this._game.goToPreviousMenu()}}class Tm{constructor(n){this._game=n}execute(n){this._game.goToSubMenu(n)}}const Re=E.sprites;class Am{toggleMuteButtonSprite(){const n=Re.paths.muteButton,i=Re.paths.muteButtonHovered;Re.paths.muteButton=Re.paths.muteButtonPressed,Re.paths.muteButtonHovered=Re.paths.muteButtonPressedHovered,Re.paths.muteButtonPressed=n,Re.paths.muteButtonPressedHovered=i}execute(){E.soundOn=!E.soundOn,this.toggleMuteButtonSprite()}}class Cm{constructor(n){this._game=n}execute(n){E.ai.playerIndex=Math.floor(Math.random()*2),E.ai.on=!0,E.ai.trainIterations=n,this._game.start()}}class Em{constructor(n){this._game=n}execute(){E.ai.on=!1,this._game.start()}}const Bs=E.sprites,Ia=E.sounds;class Pm{constructor(){A(this,"_sprites");A(this,"_sounds");this._sprites=new Map,this._sounds=new Map}loadSprite(n){const i=new Image;return this._sprites.set(n,i),new Promise(o=>{i.onload=()=>o(),i.src=Bs.basePath+n})}loadSprite2(n){return new Promise(i=>{const o=new Image;o.onload=()=>{const f=document.createElement("canvas"),_=f.getContext("2d");f.width=o.width/2,f.height=o.height/2,_&&_.drawImage(o,0,0,f.width,f.height);const b=new Image;b.onload=()=>{this._sprites.set(n,b),i()},b.src=f.toDataURL()},o.src=Bs.basePath+n})}async loadGameSprites(){const n=Object.values(Bs.paths).map(this.loadSprite.bind(this));await Promise.all(n)}loadSound(n){const i=new Audio(Ia.basePath+n);return this._sounds.set(n,i),i.load(),new Promise(o=>{i.onloadeddata=()=>o()})}async loadGameSounds(){const n=Object.values(Ia.paths).map(this.loadSound.bind(this));await Promise.all(n)}async loadGameAssets(){await this.loadGameSounds(),await this.loadGameSprites()}getSprite(n){return this._sprites.get(n)}getSound(n){return this._sounds.get(n).cloneNode(!0)}playSound(n,i){if(E.soundOn){const o=this.getSound(n);o.volume=i,o.play()}}}const pt=new Pm,Om=E.input,La=E.cursor,Ts=E.sprites;class Rm{constructor(n,i,o,f,_){A(this,"_activeSprite");A(this,"_hovered");this._command=n,this._value=i,this._position=o,this._spriteKey=f,this._spriteOnHoverKey=_,this._activeSprite=pt.getSprite(Ts.paths[this._spriteKey])}set hovered(n){this._hovered=n}isInsideButton(n){return n.x>this._position.x&&n.x<this._position.x+this._activeSprite.width&&n.y>this._position.y&&n.y<this._position.y+this._activeSprite.height}handleInput(){this.hovered=this.isInsideButton(ye.position),this._activeSprite=this._hovered?pt.getSprite(Ts.paths[this._spriteOnHoverKey]):pt.getSprite(Ts.paths[this._spriteKey]),this._hovered&&ye.isPressed(Om.mouseSelectButton)&&(z.changeCursor(La.default),this._command.execute(this._value))}update(){this.handleInput()}draw(){this._hovered&&z.changeCursor(La.button),z.drawImage(this._activeSprite,this._position)}}class Im{constructor(n,i,o,f,_){this._text=n,this._position=i,this._font=o,this._color=f,this._alignment=_}draw(){z.drawText(this._text,this._font,this._color,this._position,this._alignment)}}const Lm=E.cursor,km=E.sprites;class qs{constructor(){A(this,"_labels");A(this,"_buttons");A(this,"_active");A(this,"_subMenus")}set active(n){this._active=n}get active(){return this._active}init(n,i){this._buttons=i.buttons.map(o=>new Rm(n.get(o.action),o.value,o.position,o.sprite,o.spriteOnHover)),this._labels=i.labels.map(o=>new Im(o.text,o.position,o.font,o.color,o.alignment)),this._subMenus=i.subMenus.map(o=>{const f=new qs;return f.init(n,o),f})}getSubMenu(n){return this._subMenus[n]}update(){this._active&&this._buttons.forEach(n=>n.update()),this._subMenus.forEach(n=>n.update())}draw(){this._active&&(z.changeCursor(Lm.default),z.drawImage(pt.getSprite(km.paths.menuBackground)),this._labels.forEach(n=>n.draw()),this._buttons.forEach(n=>n.draw())),this._subMenus.forEach(n=>n.draw())}}const ll=(u,n,i,o,f)=>{let _=(u-n)*(f-o)/(i-n)+o;return _=_<o?o:_,_=_>f?f:_,_};var V=(u=>(u.white="#BABABA",u.black="#2B2B2B",u.red="#B62A2F",u.yellow="#FECA34",u))(V||{});class Mm{isValidFirstTouch(n,i,o){return i?n.color?n.color===i||n.matchScore===1&&o&&i!==V.black||n.matchScore===7&&i===V.black||n.matchScore===8&&i===V.black:i!==V.black:!1}isValidPocketedBalls(n,i){if(i.length===0)return!0;if(n.color)return n.matchScore===8?i.length===1&&i[0].color===V.black:i.every(o=>o.color===n.color);{const o=i[0].color;return o!==V.white&&o!==V.black&&i.every(f=>f.color===o)}}isValidTurn(n,i){return this.isValidFirstTouch(n,i.firstCollidedBallColor,i.pocketedBalls.length>0)&&this.isValidPocketedBalls(n,i.pocketedBalls)}isGameOver(n,i,o){return!o.visible||!i.visible&&n.matchScore===7||!i.visible&&n.matchScore===8}}class ka{constructor(){A(this,"color");A(this,"matchScore",0);A(this,"overallScore",0)}}class Nm{constructor(){A(this,"_keyStates",[]);for(let n=0;n<256;n++)this._keyStates[n]=new $a;document.addEventListener("keyup",n=>this.handleKeyUp(n)),document.addEventListener("keydown",n=>this.handleKeyDown(n))}handleKeyUp(n){this._keyStates[n.keyCode].down=!1}handleKeyDown(n){this._keyStates[n.keyCode].pressed=!0,this._keyStates[n.keyCode].down=!0}reset(){for(let n=0;n<256;n++)this._keyStates[n].pressed=!1}isDown(n){return this._keyStates[n].down}isPressed(n){return this._keyStates[n].pressed}}const Vr=new Nm,Ma=E.input,Ie=E.stick,Dm=E.sprites,Wm=E.sounds;class Fm{constructor(n){A(this,"_sprite",pt.getSprite(Dm.paths.stick));A(this,"_rotation",0);A(this,"_origin",D.copy(Ie.origin));A(this,"_power",0);A(this,"_movable",!0);A(this,"_visible",!0);this._position=n}get position(){return D.copy(this._position)}get rotation(){return this._rotation}get power(){return this._power}set movable(n){this._movable=n}get visible(){return this._visible}set visible(n){this._visible=n}set rotation(n){this._rotation=n}increasePower(){this._power+=Ie.powerToAddPerFrame,this._origin.addToX(Ie.movementPerFrame)}decreasePower(){this._power-=Ie.powerToAddPerFrame,this._origin.addToX(-3)}isLessThanMaxPower(){return this._power<Ie.maxPower}isMoreThanMinPower(){return this._power>=0}updatePower(){Vr.isDown(Ma.increaseShotPowerKey)&&this.isLessThanMaxPower()?this.increasePower():Vr.isDown(Ma.decreaseShotPowerKey)&&this.isMoreThanMinPower()&&this.decreasePower()}updateRotation(n){this._rotation=n}hide(){this._power=0,this._visible=!1,this._movable=!1}show(n){this._position=n,this._origin=D.copy(Ie.origin),this._movable=!0,this._visible=!0}shoot(){this._origin=D.copy(Ie.shotOrigin);const n=ll(this._power,0,Ie.maxPower,0,1);pt.playSound(Wm.paths.strike,n)}update(n){this._movable&&(this.updateRotation(n),this.updatePower())}draw(){this._visible&&z.drawImage(this._sprite,this._position,this._rotation,this._origin)}}const Na=E.physics,Hr=E.sprites,Da=E.ball;class qn{constructor(n,i){A(this,"_sprite");A(this,"_color");A(this,"_velocity",D.zero);A(this,"_moving",!1);A(this,"_visible",!0);this._position=n,this._color=i,this.resolveSprite(i)}get position(){return D.copy(this._position)}set position(n){this._position=n}get nextPosition(){return this.position.add(this._velocity.mult(1-Na.friction))}get velocity(){return D.copy(this._velocity)}set velocity(n){this._moving=n.length>0,this._velocity=n}get moving(){return this._moving}get color(){return this._color}get visible(){return this._visible}resolveSprite(n){switch(n){case V.white:this._sprite=pt.getSprite(Hr.paths.cueBall);break;case V.black:this._sprite=pt.getSprite(Hr.paths.blackBall);break;case V.red:this._sprite=pt.getSprite(Hr.paths.redBall);break;case V.yellow:this._sprite=pt.getSprite(Hr.paths.yellowBall);break}}shoot(n,i){this._velocity=new D(n*Math.cos(i),n*Math.sin(i)),this._moving=!0}show(n){this._position=n,this._velocity=D.zero,this._visible=!0}hide(){this._velocity=D.zero,this._moving=!1,this._visible=!1}update(){this._moving&&(this._velocity.multBy(1-Na.friction),this._position.addTo(this._velocity),this._velocity.length<Da.minVelocityLength&&(this.velocity=D.zero,this._moving=!1))}draw(){this._visible&&z.drawImage(this._sprite,this._position,0,Da.origin)}}class Wa{constructor(){A(this,"firstCollidedBallColor");A(this,"pocketedBalls",[]);A(this,"ballInHand",!1);A(this,"isValid",!1)}}const As=E.physics,Fa=E.input,Ut=E.ball,ne=E.table,me=E.labels,Ua=E.matchScore,Ha=E.ai,Gr=E.gameSize,Cs=E.sprites,Ga=E.sounds;class qa{constructor(){A(this,"_stick");A(this,"_cueBall");A(this,"_8Ball");A(this,"_balls");A(this,"_players",[new ka,new ka]);A(this,"_currentPlayerIndex",0);A(this,"_turnState");A(this,"_referee");this.initMatch()}get currentPlayer(){return this._players[this._currentPlayerIndex]}get nextPlayer(){return this._players[(this._currentPlayerIndex+1)%this._players.length]}get balls(){return this._balls}get isBallInHand(){return this._turnState.ballInHand}get isTurnValid(){return this._turnState.isValid}get isGameOver(){return this._referee.isGameOver(this.currentPlayer,this._cueBall,this._8Ball)}get isBallsMoving(){return this._balls.some(n=>n.moving)}get numOfPocketedBallsOnTurn(){return this._turnState.pocketedBalls.length}getBallsByColor(n){return this._balls.filter(i=>i.color===n)}handleInput(){Gn.finishedSession&&ye.isPressed(Fa.mouseShootButton)&&this.shootCueBall(this._stick.power,this._stick.rotation)}isBallPosOutsideTopBorder(n){return n.y-Ut.diameter/2<=ne.cushionWidth}isBallPosOutsideLeftBorder(n){return n.x-Ut.diameter/2<=ne.cushionWidth}isBallPosOutsideRightBorder(n){return n.x+Ut.diameter/2>=Gr.x-ne.cushionWidth}isBallPosOutsideBottomBorder(n){return n.y+Ut.diameter/2>=Gr.y-ne.cushionWidth}handleCollisionWithTopCushion(n){n.position=n.position.addY(ne.cushionWidth-n.position.y+Ut.diameter/2),n.velocity=new D(n.velocity.x,-n.velocity.y)}handleCollisionWithLeftCushion(n){n.position=n.position.addX(ne.cushionWidth-n.position.x+Ut.diameter/2),n.velocity=new D(-n.velocity.x,n.velocity.y)}handleCollisionWithRightCushion(n){n.position=n.position.addX(Gr.x-ne.cushionWidth-n.position.x-Ut.diameter/2),n.velocity=new D(-n.velocity.x,n.velocity.y)}handleCollisionWithBottomCushion(n){n.position=n.position.addY(Gr.y-ne.cushionWidth-n.position.y-Ut.diameter/2),n.velocity=new D(n.velocity.x,-n.velocity.y)}resolveBallCollisionWithCushion(n){let i=!1;this.isBallPosOutsideTopBorder(n.nextPosition)&&(this.handleCollisionWithTopCushion(n),i=!0),this.isBallPosOutsideLeftBorder(n.nextPosition)&&(this.handleCollisionWithLeftCushion(n),i=!0),this.isBallPosOutsideRightBorder(n.nextPosition)&&(this.handleCollisionWithRightCushion(n),i=!0),this.isBallPosOutsideBottomBorder(n.nextPosition)&&(this.handleCollisionWithBottomCushion(n),i=!0),i&&(n.velocity=n.velocity.mult(1-As.collisionLoss))}resolveBallsCollision(n,i){if(!n.visible||!i.visible)return!1;const o=n.position.subtract(i.position),f=o.length;if(f>Ut.diameter)return!1;const _=o.mult((Ut.diameter-f)/f);n.position=n.position.add(_.mult(.5)),i.position=i.position.subtract(_.mult(.5));const b=o.mult(1/o.length),P=new D(-b.y,b.x),L=b.dot(n.velocity),ct=P.dot(n.velocity),tt=b.dot(i.velocity),F=P.dot(i.velocity),Zt=b.mult(tt),we=P.mult(ct),xe=b.mult(L),$e=P.mult(F);return n.velocity=Zt.add(we),i.velocity=xe.add($e),n.velocity=n.velocity.mult(1-As.collisionLoss),i.velocity=i.velocity.mult(1-As.collisionLoss),!0}handleCollisions(){for(let n=0;n<this._balls.length;n++){this.resolveBallCollisionWithCushion(this._balls[n]);for(let i=n+1;i<this._balls.length;i++){const o=this._balls[n],f=this._balls[i];if(this.resolveBallsCollision(o,f)){const b=o.velocity.length+f.velocity.length,P=ll(b,0,Ut.maxExpectedCollisionForce,0,1);if(pt.playSound(Ga.paths.ballsCollide,P),!this._turnState.firstCollidedBallColor){const L=o.color===V.white?f.color:o.color;this._turnState.firstCollidedBallColor=L}}}}}isInsidePocket(n){return ne.pocketsPositions.some(i=>n.distFrom(i)<=ne.pocketRadius)}resolveBallInPocket(n){this.isInsidePocket(n.position)&&n.hide()}isValidPlayerColor(n){return n===V.red||n===V.yellow}handleBallsInPockets(){this._balls.forEach(n=>{this.resolveBallInPocket(n),!n.visible&&!this._turnState.pocketedBalls.includes(n)&&(pt.playSound(Ga.paths.rail,1),!this.currentPlayer.color&&this.isValidPlayerColor(n.color)&&(this.currentPlayer.color=n.color,this.nextPlayer.color=n.color===V.yellow?V.red:V.yellow),this._turnState.pocketedBalls.push(n))})}handleBallInHand(){ye.isPressed(Fa.mousePlaceBallButton)&&this.isValidPosToPlaceCueBall(ye.position)?this.placeBallInHand(ye.position):(this._stick.movable=!1,this._stick.visible=!1,this._cueBall.position=ye.position)}handleGameOver(){this._turnState.isValid?this.currentPlayer.overallScore++:this.nextPlayer.overallScore++,this.initMatch()}nextTurn(){const n=!this._turnState.isValid;if(this.isGameOver){this.handleGameOver();return}this._cueBall.visible||this._cueBall.show(D.copy(E.cueBallPosition)),(n||this._turnState.pocketedBalls.length===0)&&(this._currentPlayerIndex++,this._currentPlayerIndex=this._currentPlayerIndex%this._players.length),this._stick.show(this._cueBall.position),this._turnState=new Wa,this._turnState.ballInHand=n,this.isAITurn()&&Gn.startSession(this)}drawCurrentPlayerLabel(){z.drawText(me.currentPlayer.text+(this._currentPlayerIndex+1),me.currentPlayer.font,me.currentPlayer.color,me.currentPlayer.position,me.currentPlayer.alignment)}drawMatchScores(){for(let n=0;n<this._players.length;n++)for(let i=0;i<this._players[n].matchScore;i++){const o=D.copy(Ua.scoresPositions[n]).addToX(i*Ua.unitMargin),f=this._players[n].color===V.red?pt.getSprite(Cs.paths.redScore):pt.getSprite(Cs.paths.yellowScore);z.drawImage(f,o)}}drawOverallScores(){for(let n=0;n<this._players.length;n++)z.drawText(this._players[n].overallScore.toString(),me.overalScores[n].font,me.overalScores[n].color,me.overalScores[n].position,me.overalScores[n].alignment)}isInsideTableBoundaries(n){let i=!this.isInsidePocket(n);return i=i&&!this.isBallPosOutsideTopBorder(n),i=i&&!this.isBallPosOutsideLeftBorder(n),i=i&&!this.isBallPosOutsideRightBorder(n),i=i&&!this.isBallPosOutsideBottomBorder(n),i}isAITurn(){return Gn.finishedSession&&Ha.on&&this._currentPlayerIndex===Ha.playerIndex}initMatch(){this._cueBall=new qn(D.copy(E.cueBallPosition),V.white),this._stick=new Fm(D.copy(E.cueBallPosition)),this._balls=[],this._currentPlayerIndex=0,this._players.forEach(n=>{n.matchScore=0,n.color=null}),this._turnState=new Wa,this._referee=new Mm,this.isAITurn()&&Gn.startSession(this)}isValidPosToPlaceCueBall(n){return this._balls.every(o=>o.color===V.white||o.position.distFrom(n)>Ut.diameter)&&this.isInsideTableBoundaries(n)}placeBallInHand(n){this._cueBall.position=n,this._turnState.ballInHand=!1,this._stick.show(this._cueBall.position)}concludeTurn(){this._turnState.pocketedBalls.forEach(n=>{const i=this._balls.indexOf(n);n.color!=V.white&&this._balls.splice(i,1)}),this.currentPlayer.color&&(this.currentPlayer.matchScore=8-this.getBallsByColor(this.currentPlayer.color).length-this.getBallsByColor(V.black).length),this.nextPlayer.color&&(this.nextPlayer.matchScore=8-this.getBallsByColor(this.nextPlayer.color).length-this.getBallsByColor(V.black).length),this._turnState.isValid=this._referee.isValidTurn(this.currentPlayer,this._turnState)}shootCueBall(n,i){n>0&&(this._stick.rotation=i,this._stick.shoot(),this._cueBall.shoot(n,i),this._stick.movable=!1,setTimeout(()=>this._stick.hide(),E.timeoutToHideStickAfterShot))}update(){if(this.isBallInHand){this.handleBallInHand();return}this.handleBallsInPockets(),this.handleCollisions(),this.handleInput(),this._balls.forEach(n=>n.update()),!this.isBallsMoving&&!this._stick.visible&&(this.concludeTurn(),this.nextTurn())}draw(){z.drawImage(pt.getSprite(Cs.paths.table)),this.drawCurrentPlayerLabel(),this.drawMatchScores(),this.drawOverallScores(),this._balls.forEach(n=>n.draw()),this._stick.draw()}}class Um{constructor(n){A(this,"mainGame");this.mainGame=n}handleRotatedStick(n,i,o){const f=n[0];this.updateStick(f.rotation)}updateStick(n){this.mainGame._poolGame._stick.update(n)}handleCueMoved(n,i){const o=new D(n.x,n.y);this.mainGame._poolGame._cueBall.position=o,this.mainGame._poolGame._stick.show(o)}drawAll(){}}const Hm=E.sprites,Gm=E.input;class qm{constructor(){A(this,"_menuActionsMap");A(this,"_previousMenus",[]);A(this,"_menu",new qs);A(this,"_poolGame");A(this,"_isLoading");A(this,"_inGame")}initMenuActions(){this._menuActionsMap=new Map,this._menuActionsMap.set(yt.PVP,new Em(this)),this._menuActionsMap.set(yt.PVC,new Cm(this)),this._menuActionsMap.set(yt.ToggleSound,new Am),this._menuActionsMap.set(yt.GoToSubMenu,new Tm(this)),this._menuActionsMap.set(yt.GoToPreviousMenu,new Bm(this))}initMainMenu(){this._menu.init(this._menuActionsMap,E.mainMenu)}displayLoadingScreen(){return new Promise(n=>{this._isLoading=!0,z.clear(),z.drawImage(pt.getSprite(Hm.paths.controls),E.loadingScreenImagePosition),setTimeout(()=>{this._isLoading=!1,n()},E.loadingScreenTimeout)})}handleInput(){this._inGame&&Vr.isPressed(Gm.toggleMenuKey)&&(this._menu.active?this._menu.active=!1:(this.initMainMenu(),this._menu.active=!0))}update(){this._isLoading||(this.handleInput(),this._menu.active?this._menu.update():this._poolGame.update(),Vr.reset(),ye.reset())}draw(){this._isLoading||Gn.finishedSession&&(z.clear(),this._menu.active?this._menu.draw():this._poolGame.draw())}gameLoop(){this.draw(),window.requestAnimationFrame(()=>{this.gameLoop()})}async init(){await pt.loadGameAssets(),this.initMenuActions(),this.initMainMenu(),this._menu.active=!0,this._poolGame=new qa,this.gameLoop(),this.start()}goToSubMenu(n){setTimeout(()=>{this._menu&&(this._menu.active=!1,this._previousMenus.push(this._menu)),this._menu=this._menu.getSubMenu(n),this._menu.active=!0},E.timeoutToLoadSubMenu)}goToPreviousMenu(){this._previousMenus.length>0&&setTimeout(()=>{this._menu.active=!1,this._menu=this._previousMenus.pop(),this._menu.active=!0},E.timeoutToLoadSubMenu)}start(){this.displayLoadingScreen().then(async()=>{this._menu.active=!1,this._inGame=!0,this._poolGame=new qa,this._poolGame.initMatch();const n=new Um(this);console.log("emitting join game");const{username:i,avatar:o}=await ym(y.serverData.playerId);y.socket.emit("join_game",{lobbyCode:y.lobbyCode,playerId:y.serverData.playerId,username:i,avatar:o}),y.socket.on("get_player_number",async _=>{y.myPlayerNumber=_,_==1?(y.p1u.innerText=i,y.p1a.src=o):(y.p2u.innerText=i,y.p2a.src=o),wt()?y.domTurn.innerText="YOUR TURN":y.domTurn.innerText="OPP TURN"}),y.socket.on("players",async(_,b)=>{y.myPlayerNumber==1?(y.p2u.innerText=b.username,y.p2a.src=b.avatar):(y.p1u.innerText=_.username,y.p1a.src=_.avatar)}),y.socket.on("start_game",()=>{y.started=!0,console.log("starting game")}),y.socket.once("first_state",(_,b,P,L)=>{console.log("first state"),f(_)}),y.socket.on("rotated_stick",(_,b,P)=>{n.handleRotatedStick(_,b,P)}),y.socket.on("cue_moved",(_,b)=>{f(b),n.handleCueMoved(_,b)}),y.socket.on("update",_=>{f(_)}),y.socket.on("update_stick",_=>{y.cue.x=_.x,y.cue.y=_.y;const b=new D(_.x,_.y);n.mainGame._poolGame._stick.show(b)}),y.socket.on("switch_turn",(_,b,P)=>{y.currentTurn=_,wt()?y.domTurn.innerText="YOUR TURN":y.domTurn.innerText="OPP TURN",b&&(y.opponentInvalidCue=!0);const L=P.filter(tt=>tt.label=="cue")[0];console.log(L),y.cue.x=L.x,y.cue.y=L.y;const ct=new D(L.x,L.y);n.mainGame._poolGame._stick.show(ct),f(P)}),y.socket.on("colors",(_,b)=>{y.p1aDiv.style.border=`4px solid ${_.color}`,y.p2aDiv.style.border=`4px solid ${b.color}`}),y.socket.on("winner",_=>{_.player==y.myPlayerNumber?alert("you won"):alert("you lost")}),y.socket.on("timer",_=>{y.domTime.innerText=String(_)});function f(_){n.mainGame._poolGame.balls.splice(0);const b=_.filter(F=>F.label.split(" ")[1]=="red"),P=_.filter(F=>F.label.split(" ")[1]=="yellow"),L=_.filter(F=>F.label.split(" ")[1]=="eight"),ct=_.filter(F=>F.label=="cue"),tt=[...b.map(F=>new qn(new D(F.x,F.y),V.red)),...P.map(F=>new qn(new D(F.x,F.y),V.yellow)),...L.map(F=>new qn(new D(F.x,F.y),V.black)),...ct.map(F=>new qn(new D(F.x,F.y),V.white))];n.mainGame._poolGame.balls.push(...tt)}})}}const $m=new qm;$m.init();
